“
ND:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\AsaDatabaseBenchmark.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .

Benchmarks. 8
{ 
public 

class  
AsaDatabaseBenchmark %
{ 
public

 
static

 
readonly

 
ConcurrentBag

 ,
<

, -
FileSystemObject

- =
>

= >
BagOfObjects

? K
=

L M
new

N Q
ConcurrentBag

R _
<

_ `
FileSystemObject

` p
>

p q
(

q r
)

r s
;

s t
public 
static 
FileSystemObject &
GetRandomObject' 6
(6 7
int7 :
ObjectPadding; H
=I J
$numK L
)L M
{ 	
BagOfObjects 
. 
TryTake  
(  !
out! $
FileSystemObject% 5
?5 6
obj7 :
): ;
;; <
if 
( 
obj 
!= 
null 
) 
{ 
obj 
. 
Path 
= 
CryptoHelpers (
.( )
GetRandomString) 8
(8 9
$num9 ;
); <
;< =
return 
obj 
; 
} 
else 
{ 
return 
new 
FileSystemObject +
(+ ,
CryptoHelpers, 9
.9 :
GetRandomString: I
(I J
$numJ L
)L M
)M N
{ 
FileType 
= 
CryptoHelpers ,
., -
GetRandomString- <
(< =
ObjectPadding= J
)J K
,K L
} 
; 
} 
} 	
} 
} » 
DD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\CommitTest.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .

Benchmarks. 8
{ 
[ %
MarkdownExporterAttribute 
. 
GitHub %
]% &
[ !
JsonExporterAttribute 
. 
Full 
]  
public 

class 

CommitTest 
{		 
public 

CommitTest 
( 
) 
{ 	
Logger 
. 
Setup 
( 
true 
, 
true #
)# $
;$ %
Strings 
. 
Setup 
( 
) 
; 
} 	
[ 	
Params	 
( 
$str 
, 
$str 
,  
$str! &
,& '
$str( 0
)0 1
]1 2
public 
string 
JournalMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Params	 
( 
$num 
, 
$num 
, 
$num #
)# $
]$ %
public 
int 
N 
{ 
get 
; 
set 
;  
}! "
[ 	
Params	 
( 
$num 
, 
$num 
, 
$num 
, 
$num 
, 
$num 
, 
$num  
,  !
$num" #
,# $
$num% &
,& '
$num( )
,) *
$num+ -
,- .
$num/ 1
,1 2
$num3 5
)5 6
]6 7
public 
int 
Shards 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
	Benchmark	 
] 
public 
void 
CommitTransaction %
(% &
)& '
{   	
	dbManager!! 
.!! 
Commit!! 
(!! 
)!! 
;!! 
}"" 	
[$$ 	
IterationCleanup$$	 
]$$ 
public%% 
void%% 
IterationCleanup%% $
(%%$ %
)%%% &
{&& 	
	dbManager'' 
.'' 
Destroy'' 
('' 
)'' 
;''  
}(( 	
[** 	
IterationSetup**	 
]** 
public++ 
void++ 
IterationSetup++ "
(++" #
)++# $
{,, 	
Setup-- 
(-- 
)-- 
;-- 
	dbManager.. 
... 
BeginTransaction.. &
(..& '
)..' (
;..( )*
InsertTestsWithoutTransactions// *
.//* +
Insert_X_Objects//+ ;
(//; <
N//< =
,//= >
	dbManager//? H
)//H I
;//I J
}00 	
public22 
void22 
Setup22 
(22 
)22 
{33 	
	dbManager44 
=44 
new44 !
SqliteDatabaseManager44 1
(441 2
filename442 :
:44: ;
$"44< >
$str44> K
{44K L
Shards44L R
}44R S
$str44S Z
"44Z [
,44[ \
new44] `

DBSettings44a k
(44k l
)44l m
{55 
JournalMode66 
=66 
JournalMode66 )
,66) *
ShardingFactor77 
=77  
Shards77! '
}88 
)88 
;88 
	dbManager99 
.99 
Setup99 
(99 
)99 
;99 
}:: 	
private<< 
DatabaseManager<< 
	dbManager<<  )
;<<) *
}?? 
}@@ ÀP
ED:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\CryptoTests.cs
	namespace		 	
	Microsoft		
 
.		 
CST		 
.		 !
AttackSurfaceAnalyzer		 -
.		- .

Benchmarks		. 8
{

 
[ %
MarkdownExporterAttribute 
. 
GitHub %
]% &
[ !
JsonExporterAttribute 
. 
Full 
]  
public 

class 
CryptoTests 
:  
AsaDatabaseBenchmark 3
{ 
public 
CryptoTests 
( 
) 
{ 	
} 	
[ 	
Params	 
( 
$num 
) 
] 
public 
int 
N 
{ 
get 
; 
set 
;  
}! "
[ 	
Params	 
( 
$num 
) 
] 
public 
int 

NumObjects 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Params	 
( 
$num 
) 
] 
public 
int 
ObjectPadding  
{! "
get# &
;& '
set( +
;+ ,
}- .
[   	
	Benchmark  	 
]   
public!! 
void!! $
Generate_N_Murmur_Hashes!! ,
(!!, -
)!!- .
{"" 	
for## 
(## 
int## 
i## 
=## 
$num## 
;## 
i## 
<## 
N##  !
;##! "
i### $
++##$ &
)##& '
{$$ 
hashObjects%% 
.%% 

TryDequeue%% &
(%%& '
out%%' *
byte%%+ /
[%%/ 0
]%%0 1
?%%1 2
result%%3 9
)%%9 :
;%%: ;
if&& 
(&& 
result&& 
is&& 
byte&& "
[&&" #
]&&# $
)&&$ %
{'' 
_(( 
=(( 
	murmur128(( !
.((! "
ComputeHash((" -
(((- .
result((. 4
)((4 5
;((5 6
hashObjects)) 
.))  
Enqueue))  '
())' (
result))( .
))). /
;))/ 0
}** 
else++ 
{,, 
Log-- 
.-- 
Information-- #
(--# $
$str--$ F
)--F G
;--G H
}.. 
}// 
}00 	
[22 	
	Benchmark22	 
(22 
Baseline22 
=22 
true22 "
)22" #
]22# $
public33 
void33 $
Generate_N_SHA256_Hashes33 ,
(33, -
)33- .
{44 	
for55 
(55 
int55 
i55 
=55 
$num55 
;55 
i55 
<55 
N55  !
;55! "
i55# $
++55$ &
)55& '
{66 
hashObjects77 
.77 

TryDequeue77 &
(77& '
out77' *
byte77+ /
[77/ 0
]770 1
?771 2
result773 9
)779 :
;77: ;
if88 
(88 
result88 
is88 
byte88 "
[88" #
]88# $
)88$ %
{99 
_:: 
=:: 
sha256:: 
.:: 
ComputeHash:: *
(::* +
result::+ 1
)::1 2
;::2 3
hashObjects;; 
.;;  
Enqueue;;  '
(;;' (
result;;( .
);;. /
;;;/ 0
}<< 
else== 
{>> 
Log?? 
.?? 
Information?? #
(??# $
$str??$ F
)??F G
;??G H
}@@ 
}AA 
}BB 	
[DD 	
	BenchmarkDD	 
]DD 
publicEE 
voidEE +
Generate_N_SHA256Managed_HashesEE 3
(EE3 4
)EE4 5
{FF 	
forGG 
(GG 
intGG 
iGG 
=GG 
$numGG 
;GG 
iGG 
<GG 
NGG  !
;GG! "
iGG# $
++GG$ &
)GG& '
{HH 
hashObjectsII 
.II 

TryDequeueII &
(II& '
outII' *
byteII+ /
[II/ 0
]II0 1
?II1 2
resultII3 9
)II9 :
;II: ;
ifJJ 
(JJ 
resultJJ 
isJJ 
byteJJ "
[JJ" #
]JJ# $
)JJ$ %
{KK 
_LL 
=LL 
sha256managedLL %
.LL% &
ComputeHashLL& 1
(LL1 2
resultLL2 8
)LL8 9
;LL9 :
hashObjectsMM 
.MM  
EnqueueMM  '
(MM' (
resultMM( .
)MM. /
;MM/ 0
}NN 
elseOO 
{PP 
LogQQ 
.QQ 
InformationQQ #
(QQ# $
$strQQ$ F
)QQF G
;QQG H
}RR 
}SS 
}TT 	
[VV 	
	BenchmarkVV	 
]VV 
publicWW 
voidWW $
Generate_N_SHA512_HashesWW ,
(WW, -
)WW- .
{XX 	
forYY 
(YY 
intYY 
iYY 
=YY 
$numYY 
;YY 
iYY 
<YY 
NYY  !
;YY! "
iYY# $
++YY$ &
)YY& '
{ZZ 
hashObjects[[ 
.[[ 

TryDequeue[[ &
([[& '
out[[' *
byte[[+ /
[[[/ 0
][[0 1
?[[1 2
result[[3 9
)[[9 :
;[[: ;
if\\ 
(\\ 
result\\ 
is\\ 
byte\\ "
[\\" #
]\\# $
)\\$ %
{]] 
_^^ 
=^^ 
sha512^^ 
.^^ 
ComputeHash^^ *
(^^* +
result^^+ 1
)^^1 2
;^^2 3
hashObjects__ 
.__  
Enqueue__  '
(__' (
result__( .
)__. /
;__/ 0
}`` 
elseaa 
{bb 
Logcc 
.cc 
Informationcc #
(cc# $
$strcc$ F
)ccF G
;ccG H
}dd 
}ee 
}ff 	
[hh 	
	Benchmarkhh	 
]hh 
publicii 
voidii ,
 Generate_N_SHA512_Managed_Hashesii 4
(ii4 5
)ii5 6
{jj 	
forkk 
(kk 
intkk 
ikk 
=kk 
$numkk 
;kk 
ikk 
<kk 
Nkk  !
;kk! "
ikk# $
++kk$ &
)kk& '
{ll 
hashObjectsmm 
.mm 

TryDequeuemm &
(mm& '
outmm' *
bytemm+ /
[mm/ 0
]mm0 1
?mm1 2
resultmm3 9
)mm9 :
;mm: ;
ifnn 
(nn 
resultnn 
isnn 
bytenn "
[nn" #
]nn# $
)nn$ %
{oo 
_pp 
=pp 
sha512managedpp %
.pp% &
ComputeHashpp& 1
(pp1 2
resultpp2 8
)pp8 9
;pp9 :
hashObjectsqq 
.qq  
Enqueueqq  '
(qq' (
resultqq( .
)qq. /
;qq/ 0
}rr 
elsess 
{tt 
Loguu 
.uu 
Informationuu #
(uu# $
$struu$ F
)uuF G
;uuG H
}vv 
}ww 
}xx 	
[zz 	
GlobalSetupzz	 
]zz 
public{{ 
void{{ 
GlobalSetup{{ 
({{  
){{  !
{|| 	
while}} 
(}} 
hashObjects}} 
.}} 
Count}} $
<}}% &

NumObjects}}' 1
)}}1 2
{~~ 
hashObjects 
. 
Enqueue #
(# $
Encoding$ ,
., -
UTF8- 1
.1 2
GetBytes2 :
(: ;
JsonConvert; F
.F G
SerializeObjectG V
(V W
GetRandomObjectW f
(f g
ObjectPaddingg t
)t u
)u v
)v w
)w x
;x y
}
ÄÄ 
}
ÅÅ 	
private
ÉÉ 
static
ÉÉ 
readonly
ÉÉ 
HashAlgorithm
ÉÉ  -
	murmur128
ÉÉ. 7
=
ÉÉ8 9

MurmurHash
ÉÉ: D
.
ÉÉD E
	Create128
ÉÉE N
(
ÉÉN O
)
ÉÉO P
;
ÉÉP Q
private
ÖÖ 
static
ÖÖ 
readonly
ÖÖ 
HashAlgorithm
ÖÖ  -
sha256
ÖÖ. 4
=
ÖÖ5 6
SHA256
ÖÖ7 =
.
ÖÖ= >
Create
ÖÖ> D
(
ÖÖD E
)
ÖÖE F
;
ÖÖF G
private
áá 
static
áá 
readonly
áá 
HashAlgorithm
áá  -
sha256managed
áá. ;
=
áá< =
SHA256Managed
áá> K
.
ááK L
Create
ááL R
(
ááR S
)
ááS T
;
ááT U
private
ââ 
static
ââ 
readonly
ââ 
HashAlgorithm
ââ  -
sha512
ââ. 4
=
ââ5 6
SHA512
ââ7 =
.
ââ= >
Create
ââ> D
(
ââD E
)
ââE F
;
ââF G
private
ãã 
static
ãã 
readonly
ãã 
HashAlgorithm
ãã  -
sha512managed
ãã. ;
=
ãã< =
SHA512Managed
ãã> K
.
ããK L
Create
ããL R
(
ããR S
)
ããS T
;
ããT U
private
çç 
readonly
çç 
ConcurrentQueue
çç (
<
çç( )
byte
çç) -
[
çç- .
]
çç. /
>
çç/ 0
hashObjects
çç1 <
=
çç= >
new
çç? B
ConcurrentQueue
ççC R
<
ççR S
byte
ççS W
[
ççW X
]
ççX Y
>
ççY Z
(
ççZ [
)
çç[ \
;
çç\ ]
}
éé 
}èè ô:
aD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\InsertTestsWithIntermittentTransactions.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .

Benchmarks. 8
{ 
[ %
MarkdownExporterAttribute 
. 
GitHub %
]% &
[		 !
JsonExporterAttribute		 
.		 
Full		 
]		  
public

 

class

 3
'InsertTestsWithIntermittentTransactions

 8
:

9 : 
AsaDatabaseBenchmark

; O
{ 
public 3
'InsertTestsWithIntermittentTransactions 6
(6 7
)7 8
{ 	
Logger 
. 
Setup 
( 
true 
, 
true #
)# $
;$ %
Strings 
. 
Setup 
( 
) 
; 
} 	
[ 	
Params	 
( 
- 
$num 
) 
] 
public 
int 

FlushCount 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Params	 
( 
$str 
) 
] 
public 
string 
JournalMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[   	
Params  	 
(   
$num   
,   
$num   
)    
]    !
public!! 
int!! 
N!! 
{!! 
get!! 
;!! 
set!! 
;!!  
}!!! "
[%% 	
Params%%	 
(%% 
$num%% 
)%% 
]%% 
public&& 
int&& 
ObjectPadding&&  
{&&! "
get&&# &
;&&& '
set&&( +
;&&+ ,
}&&- .
[)) 	
Params))	 
()) 
$num)) 
))) 
])) 
public** 
int** 
Shards** 
{** 
get** 
;**  
set**! $
;**$ %
}**& '
[.. 	
Params..	 
(.. 
$num.. 
).. 
].. 
public// 
int// 
StartingSize// 
{//  !
get//" %
;//% &
set//' *
;//* +
}//, -
public33 
static33 
void33 
Insert_X_Objects33 +
(33+ ,
int33, /
X330 1
,331 2
int333 6
ObjectPadding337 D
=33E F
$num33G H
,33H I
string33J P
runName33Q X
=33Y Z
$str33[ m
)33m n
{44 	
	dbManager55 
.55 
BeginTransaction55 &
(55& '
)55' (
;55( )
Parallel77 
.77 
For77 
(77 
$num77 
,77 
X77 
,77 
i77  
=>77! #
{88 
var99 
obj99 
=99 
GetRandomObject99 )
(99) *
ObjectPadding99* 7
)997 8
;998 9
	dbManager:: 
.:: 
Write:: 
(::  
obj::  #
,::# $
runName::% ,
)::, -
;::- .
BagOfObjects;; 
.;; 
Add;;  
(;;  !
obj;;! $
);;$ %
;;;% &
}<< 
)<< 
;<< 
while>> 
(>> 
	dbManager>> 
.>> 
HasElements>> (
)>>( )
{?? 
Thread@@ 
.@@ 
Sleep@@ 
(@@ 
$num@@ 
)@@ 
;@@  
}AA 
	dbManagerCC 
.CC 
CommitCC 
(CC 
)CC 
;CC 
}DD 	
[FF 	
GlobalCleanupFF	 
]FF 
publicGG 
voidGG 
GlobalCleanupGG !
(GG! "
)GG" #
{HH 	
SetupII 
(II 
)II 
;II 
	dbManagerJJ 
.JJ 
DestroyJJ 
(JJ 
)JJ 
;JJ  
}KK 	
[MM 	
GlobalSetupMM	 
]MM 
publicNN 
voidNN 
GlobalSetupNN 
(NN  
)NN  !
{OO 	
PopulateDatabasesPP 
(PP 
)PP 
;PP  
}QQ 	
[SS 	
	BenchmarkSS	 
]SS 
publicTT 
voidTT 
Insert_N_ObjectsTT $
(TT$ %
)TT% &
=>TT' )
Insert_X_ObjectsTT* :
(TT: ;
NTT; <
,TT< =
ObjectPaddingTT> K
,TTK L
$strTTM _
)TT_ `
;TT` a
[VV 	
IterationCleanupVV	 
]VV 
publicWW 
voidWW 
IterationCleanupWW $
(WW$ %
)WW% &
{XX 	
	dbManagerYY 
.YY 
BeginTransactionYY &
(YY& '
)YY' (
;YY( )
	dbManagerZZ 
.ZZ 
	DeleteRunZZ 
(ZZ  
$strZZ  2
)ZZ2 3
;ZZ3 4
	dbManager[[ 
.[[ 
Commit[[ 
([[ 
)[[ 
;[[ 
	dbManager\\ 
.\\ 
Vacuum\\ 
(\\ 
)\\ 
;\\ 
	dbManager]] 
.]] 
CloseDatabase]] #
(]]# $
)]]$ %
;]]% &
}^^ 	
[`` 	
IterationSetup``	 
]`` 
publicaa 
voidaa 
IterationSetupaa "
(aa" #
)aa# $
{bb 	
Setupcc 
(cc 
)cc 
;cc 
}dd 	
publicff 
voidff 
PopulateDatabasesff %
(ff% &
)ff& '
{gg 	
Setuphh 
(hh 
)hh 
;hh 
Insert_X_Objectsjj 
(jj 
StartingSizejj )
,jj) *
ObjectPaddingjj+ 8
,jj8 9
$strjj: L
)jjL M
;jjM N
	dbManagerll 
.ll 
CloseDatabasell #
(ll# $
)ll$ %
;ll% &
}mm 	
publicoo 
voidoo 
Setupoo 
(oo 
)oo 
{pp 	
	dbManagerqq 
=qq 
newqq !
SqliteDatabaseManagerqq 1
(qq1 2
filenameqq2 :
:qq: ;
$"qq< >
$strqq> K
{qqK L
ShardsqqL R
}qqR S
$strqqS Z
"qqZ [
,qq[ \
newqq] `

DBSettingsqqa k
(qqk l
)qql m
{rr 
ShardingFactorss 
=ss  
Shardsss! '
,ss' (

FlushCounttt 
=tt 

FlushCounttt '
,tt' (
JournalModeuu 
=uu 
JournalModeuu )
}vv 
)vv 
;vv 
	dbManagerww 
.ww 
Setupww 
(ww 
)ww 
;ww 
}xx 	
privatezz 
staticzz 
DatabaseManagerzz &
	dbManagerzz' 0
;zz0 1
}{{ 
}|| ä@
XD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\InsertTestsWithoutTransactions.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .

Benchmarks. 8
{ 
[ %
MarkdownExporterAttribute 
. 
GitHub %
]% &
[		 !
JsonExporterAttribute		 
.		 
Full		 
]		  
public

 

class

 *
InsertTestsWithoutTransactions

 /
:

0 1 
AsaDatabaseBenchmark

2 F
{ 
public *
InsertTestsWithoutTransactions -
(- .
). /
{ 	
Logger 
. 
Setup 
( 
true 
, 
true #
)# $
;$ %
Strings 
. 
Setup 
( 
) 
; 
} 	
[ 	
Params	 
( 
$num 
) 
] 
public 
int 
	BatchSize 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Params	 
( 
$str 
) 
] 
public 
string 
JournalMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Params	 
( 
$str 
) 
] 
public 
string 
LockingMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[!! 	
Params!!	 
(!! 
$num!! 
)!! 
]!! 
public"" 
int"" 
N"" 
{"" 
get"" 
;"" 
set"" 
;""  
}""! "
[&& 	
Params&&	 
(&& 
$num&& 
,&& 
$num&& 
)&& 
]&& 
public'' 
int'' 
ObjectPadding''  
{''! "
get''# &
;''& '
set''( +
;''+ ,
}''- .
[)) 	
Params))	 
()) 
$num)) 
))) 
])) 
public** 
int** 
PageSize** 
{** 
get** !
;**! "
set**# &
;**& '
}**( )
[-- 	
Params--	 
(-- 
$num-- 
)-- 
]-- 
public.. 
int.. 
Shards.. 
{.. 
get.. 
;..  
set..! $
;..$ %
}..& '
[22 	
Params22	 
(22 
$num22 
)22 
]22 
public33 
int33 
StartingSize33 
{33  !
get33" %
;33% &
set33' *
;33* +
}33, -
[55 	
Params55	 
(55 
$str55 
)55 
]55 
public66 
string66 
Synchronous66 !
{66" #
get66$ '
;66' (
set66) ,
;66, -
}66. /
public88 
static88 
void88 
Insert_X_Objects88 +
(88+ ,
int88, /
X880 1
,881 2
DatabaseManager883 B
	dbManager88C L
,88L M
int88N Q
ObjectPadding88R _
=88` a
$num88b c
,88c d
string88e k
runName88l s
=88t u
$str	88v à
)
88à â
{99 	
Parallel:: 
.:: 
For:: 
(:: 
$num:: 
,:: 
X:: 
,:: 
i::  
=>::! #
{;; 
var<< 
obj<< 
=<< 
GetRandomObject<< )
(<<) *
ObjectPadding<<* 7
)<<7 8
;<<8 9
	dbManager== 
.== 
Write== 
(==  
obj==  #
,==# $
runName==% ,
)==, -
;==- .
BagOfObjects>> 
.>> 
Add>>  
(>>  !
obj>>! $
)>>$ %
;>>% &
}?? 
)?? 
;?? 
whileAA 
(AA 
	dbManagerAA 
.AA 
HasElementsAA (
)AA( )
{BB 
ThreadCC 
.CC 
SleepCC 
(CC 
$numCC 
)CC 
;CC  
}DD 
}EE 	
[GG 	
GlobalCleanupGG	 
]GG 
publicHH 
voidHH 
GlobalCleanupHH !
(HH! "
)HH" #
{II 	
SetupJJ 
(JJ 
)JJ 
;JJ 
	dbManagerKK 
.KK 
DestroyKK 
(KK 
)KK 
;KK  
}LL 	
[NN 	
GlobalSetupNN	 
]NN 
publicOO 
voidOO 
GlobalSetupOO 
(OO  
)OO  !
{PP 	
PopulateDatabasesQQ 
(QQ 
)QQ 
;QQ  
}RR 	
[TT 	
	BenchmarkTT	 
]TT 
publicUU 
voidUU 
Insert_N_ObjectsUU $
(UU$ %
)UU% &
=>UU' )
Insert_X_ObjectsUU* :
(UU: ;
NUU; <
,UU< =
	dbManagerUU> G
,UUG H
ObjectPaddingUUI V
,UUV W
$strUUX j
)UUj k
;UUk l
[WW 	
IterationCleanupWW	 
]WW 
publicXX 
voidXX 
IterationCleanupXX $
(XX$ %
)XX% &
{YY 	
	dbManagerZZ 
.ZZ 
CloseDatabaseZZ #
(ZZ# $
)ZZ$ %
;ZZ% &
}[[ 	
[]] 	
IterationSetup]]	 
]]] 
public^^ 
void^^ 
IterationSetup^^ "
(^^" #
)^^# $
{__ 	
Setup`` 
(`` 
)`` 
;`` 
	dbManageraa 
.aa 
BeginTransactionaa &
(aa& '
)aa' (
;aa( )
}bb 	
publicdd 
voiddd 
PopulateDatabasesdd %
(dd% &
)dd& '
{ee 	
Setupff 
(ff 
)ff 
;ff 
	dbManagergg 
.gg 
BeginTransactiongg &
(gg& '
)gg' (
;gg( )
Insert_X_Objectsii 
(ii 
StartingSizeii )
,ii) *
	dbManagerii+ 4
,ii4 5
ObjectPaddingii6 C
,iiC D
$striiE W
)iiW X
;iiX Y
	dbManagerkk 
.kk 
Commitkk 
(kk 
)kk 
;kk 
	dbManagerll 
.ll 
CloseDatabasell #
(ll# $
)ll$ %
;ll% &
}mm 	
privateoo 
DatabaseManageroo 
	dbManageroo  )
;oo) *
privateqq 
voidqq 
Setupqq 
(qq 
)qq 
{rr 	
	dbManagerss 
=ss 
newss !
SqliteDatabaseManagerss 1
(ss1 2
filenamess2 :
:ss: ;
$"ss< >
$strss> K
{ssK L
ShardsssL R
}ssR S
$strssS Z
"ssZ [
,ss[ \
newss] `

DBSettingsssa k
(ssk l
)ssl m
{tt 
JournalModeuu 
=uu 
JournalModeuu )
,uu) *
LockingModevv 
=vv 
LockingModevv )
,vv) *
PageSizeww 
=ww 
PageSizeww #
,ww# $
ShardingFactorxx 
=xx  
Shardsxx! '
,xx' (
Synchronousyy 
=yy 
Synchronousyy )
,yy) *
	BatchSizezz 
=zz 
	BatchSizezz %
}{{ 
){{ 
;{{ 
	dbManager}} 
.}} 
Setup}} 
(}} 
)}} 
;}} 
}~~ 	
} 
}ÄÄ ´)
MD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\OpenTransactionTest.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .

Benchmarks. 8
{ 
[ %
MarkdownExporterAttribute 
. 
GitHub %
]% &
[ !
JsonExporterAttribute 
. 
Full 
]  
public 

class 
OpenTransactionTest $
:% & 
AsaDatabaseBenchmark' ;
{		 
public 
OpenTransactionTest "
(" #
)# $
{ 	
Logger 
. 
Setup 
( 
true 
, 
true #
)# $
;$ %
Strings 
. 
Setup 
( 
) 
; 
} 	
[ 	
Params	 
( 
$str 
, 
$str 
,  
$str! &
,& '
$str( 0
)0 1
]1 2
public 
string 
JournalMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Params	 
( 
$num 
, 
$num 
, 
$num 
, 
$num 
, 
$num 
, 
$num  
,  !
$num" #
,# $
$num% &
,& '
$num( )
,) *
$num+ -
,- .
$num/ 1
,1 2
$num3 5
)5 6
]6 7
public 
int 
Shards 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
Params	 
( 
$num 
) 
] 
public 
int 
StartingSize 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
	Benchmark	 
] 
public   
void   
BeginTransaction   $
(  $ %
)  % &
{!! 	
	dbManager"" 
."" 
BeginTransaction"" &
(""& '
)""' (
;""( )
}## 	
[%% 	
GlobalCleanup%%	 
]%% 
public&& 
void&& 
GlobalCleanup&& !
(&&! "
)&&" #
{'' 	
Setup(( 
((( 
)(( 
;(( 
	dbManager)) 
.)) 
Destroy)) 
()) 
))) 
;))  
}** 	
[,, 	
GlobalSetup,,	 
],, 
public-- 
void-- 
GlobalSetup-- 
(--  
)--  !
{.. 	
PopulateDatabases// 
(// 
)// 
;//  
}00 	
[22 	
IterationCleanup22	 
]22 
public33 
void33 
IterationCleanup33 $
(33$ %
)33% &
{44 	
	dbManager55 
.55 
CloseDatabase55 #
(55# $
)55$ %
;55% &
}66 	
[88 	
IterationSetup88	 
]88 
public99 
void99 
IterationSetup99 "
(99" #
)99# $
{:: 	
Setup;; 
(;; 
);; 
;;; 
}<< 	
public>> 
void>> 
PopulateDatabases>> %
(>>% &
)>>& '
{?? 	
Setup@@ 
(@@ 
)@@ 
;@@ 
	dbManagerAA 
.AA 
BeginTransactionAA &
(AA& '
)AA' (
;AA( )*
InsertTestsWithoutTransactionsCC *
.CC* +
Insert_X_ObjectsCC+ ;
(CC; <
StartingSizeCC< H
,CCH I
	dbManagerCCJ S
,CCS T
$numCCU V
,CCV W
$strCCX j
)CCj k
;CCk l
	dbManagerEE 
.EE 
CommitEE 
(EE 
)EE 
;EE 
	dbManagerFF 
.FF 
CloseDatabaseFF #
(FF# $
)FF$ %
;FF% &
}GG 	
publicII 
voidII 
SetupII 
(II 
)II 
{JJ 	
	dbManagerKK 
=KK 
newKK !
SqliteDatabaseManagerKK 1
(KK1 2
filenameKK2 :
:KK: ;
$"KK< >
$strKK> K
{KKK L
ShardsKKL R
}KKR S
$strKKS Z
"KKZ [
,KK[ \
newKK] `

DBSettingsKKa k
(KKk l
)KKl m
{LL 
JournalModeMM 
=MM 
JournalModeMM )
,MM) *
ShardingFactorNN 
=NN  
ShardsNN! '
}OO 
)OO 
;OO 
	dbManagerPP 
.PP 
SetupPP 
(PP 
)PP 
;PP 
}QQ 	
privateSS 
DatabaseManagerSS 
	dbManagerSS  )
;SS) *
}TT 
}UU ˛
AD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\Program.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .

Benchmarks. 8
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
var		 
summary		 
=		 
BenchmarkRunner		 )
.		) *
Run		* -
<		- .
CryptoTests		. 9
>		9 :
(		: ;
)		; <
;		< =
}

 	
} 
} Åi
DD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\QueryTests.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .

Benchmarks. 8
{ 
[		 %
MarkdownExporterAttribute		 
.		 
GitHub		 %
]		% &
[

 !
JsonExporterAttribute

 
.

 
Full

 
]

  
public 

class 

QueryTests 
:  
AsaDatabaseBenchmark 2
{ 
public 

QueryTests 
( 
) 
{ 	
Logger 
. 
Setup 
( 
true 
, 
true #
)# $
;$ %
Strings 
. 
Setup 
( 
) 
; 
} 	
[ 	
Params	 
( 
$num 
, 
$num 
, 
$num 
, 
$num 
,  
$num! "
)" #
]# $
public 
double 
IdentityMatches %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 	
Params	 
( 
$str 
) 
] 
public 
string 
JournalMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Params	 
( 
$str 
) 
] 
public   
string   
LockingMode   !
{  " #
get  $ '
;  ' (
set  ) ,
;  , -
}  . /
[$$ 	
Params$$	 
($$ 
$num$$ 
)$$ 
]$$ 
public%% 
int%% 
ObjectPadding%%  
{%%! "
get%%# &
;%%& '
set%%( +
;%%+ ,
}%%- .
[(( 	
Params((	 
((( 
$num(( 
)(( 
](( 
public)) 
int)) 
PageSize)) 
{)) 
get)) !
;))! "
set))# &
;))& '
}))( )
[,, 	
Params,,	 
(,, 
$num,, 
,,, 
$num,, 
,,, 
$num,, 
,,, 
$num,, 
,,,  
$num,,! "
),," #
],,# $
public-- 
double-- 
RowKeyMatches-- #
{--$ %
get--& )
;--) *
set--+ .
;--. /
}--0 1
[00 	
Params00	 
(00 
$num00 
)00 
]00 
public11 
int11 

RunOneSize11 
{11 
get11  #
;11# $
set11% (
;11( )
}11* +
[44 	
Params44	 
(44 
$num44 
)44 
]44 
public55 
int55 

RunTwoSize55 
{55 
get55  #
;55# $
set55% (
;55( )
}55* +
[88 	
Params88	 
(88 
$num88 
)88 
]88 
public99 
int99 
Shards99 
{99 
get99 
;99  
set99! $
;99$ %
}99& '
[<< 	
Params<<	 
(<< 
$num<< 
)<< 
]<< 
public== 
int== 
StartingSize== 
{==  !
get==" %
;==% &
set==' *
;==* +
}==, -
[@@ 	
Params@@	 
(@@ 
$str@@ 
)@@ 
]@@ 
publicAA 
stringAA 
SynchronousAA !
{AA" #
getAA$ '
;AA' (
setAA) ,
;AA, -
}AA. /
[CC 	
	BenchmarkCC	 
]CC 
publicDD 
voidDD 
GetAllMissing2TestDD &
(DD& '
)DD' (
{EE 	
(FF 
(FF !
SqliteDatabaseManagerFF #
)FF# $
	dbManagerFF$ -
)FF- .
.FF. /
GetAllMissing2FF/ =
(FF= >

RunOneNameFF> H
,FFH I

RunTwoNameFFJ T
)FFT U
;FFU V
}GG 	
[II 	
	BenchmarkII	 
]II 
publicJJ 
voidJJ )
GetAllMissingExplicitIndexingJJ 1
(JJ1 2
)JJ2 3
{KK 	
(LL 
(LL !
SqliteDatabaseManagerLL #
)LL# $
	dbManagerLL$ -
)LL- .
.LL. /!
GetAllMissingExplicitLL/ D
(LLD E

RunOneNameLLE O
,LLO P

RunTwoNameLLQ [
)LL[ \
;LL\ ]
}MM 	
[OO 	
	BenchmarkOO	 
(OO 
BaselineOO 
=OO 
trueOO "
)OO" #
]OO# $
publicPP 
voidPP 
GetAllMissingTestPP %
(PP% &
)PP& '
{QQ 	
	dbManagerRR 
.RR 
GetAllMissingRR #
(RR# $

RunOneNameRR$ .
,RR. /

RunTwoNameRR0 :
)RR: ;
;RR; <
}SS 	
[ZZ 	
	BenchmarkZZ	 
]ZZ 
public[[ 
void[[ $
GetMissingFromFirstTwice[[ ,
([[, -
)[[- .
{\\ 	
	dbManager]] 
.]] 
GetMissingFromFirst]] )
(]]) *

RunOneName]]* 4
,]]4 5

RunTwoName]]6 @
)]]@ A
;]]A B
	dbManager^^ 
.^^ 
GetMissingFromFirst^^ )
(^^) *

RunTwoName^^* 4
,^^4 5

RunOneName^^6 @
)^^@ A
;^^A B
}__ 	
[aa 	
GlobalCleanupaa	 
]aa 
publicbb 
voidbb 
GlobalCleanupbb !
(bb! "
)bb" #
{cc 	
Setupdd 
(dd 
)dd 
;dd 
	dbManageree 
.ee 
Destroyee 
(ee 
)ee 
;ee  
}ff 	
[hh 	
GlobalSetuphh	 
]hh 
publicii 
voidii 
GlobalSetupii 
(ii  
)ii  !
{jj 	
PopulateDatabaseskk 
(kk 
)kk 
;kk  
}ll 	
publicnn 
voidnn 
InsertFirstRunnn "
(nn" #
)nn# $
{oo 	
Parallelpp 
.pp 
Forpp 
(pp 
$numpp 
,pp 

RunOneSizepp &
,pp& '
ipp( )
=>pp* ,
{qq 
varrr 
objrr 
=rr 
GetRandomObjectrr )
(rr) *
ObjectPaddingrr* 7
)rr7 8
;rr8 9
	dbManagerss 
.ss 
Writess 
(ss  
objss  #
,ss# $

RunOneNamess% /
)ss/ 0
;ss0 1
ifuu 
(uu 
objuu 
.uu 
FileTypeuu  
!=uu! #
nulluu$ (
)uu( )
{vv 
BagOfObjectsww  
.ww  !
Addww! $
(ww$ %
objww% (
)ww( )
;ww) *
}xx 
}yy 
)yy 
;yy 
while{{ 
({{ 
	dbManager{{ 
.{{ 
HasElements{{ (
){{( )
{|| 
Thread}} 
.}} 
Sleep}} 
(}} 
$num}} 
)}} 
;}}  
}~~ 
} 	
public
ÅÅ 
void
ÅÅ 
InsertSecondRun
ÅÅ #
(
ÅÅ# $
)
ÅÅ$ %
{
ÇÇ 	
Parallel
ÉÉ 
.
ÉÉ 
For
ÉÉ 
(
ÉÉ 
$num
ÉÉ 
,
ÉÉ 

RunTwoSize
ÉÉ &
,
ÉÉ& '
i
ÉÉ( )
=>
ÉÉ* ,
{
ÑÑ 
var
ÖÖ 
obj
ÖÖ 
=
ÖÖ 
GetRandomObject
ÖÖ )
(
ÖÖ) *
ObjectPadding
ÖÖ* 7
)
ÖÖ7 8
;
ÖÖ8 9
if
áá 
(
áá 
BagOfIdentities
áá #
.
áá# $
TryTake
áá$ +
(
áá+ ,
out
áá, /
(
áá0 1
string
áá1 7
,
áá7 8
string
áá9 ?
)
áá? @
Id
ááA C
)
ááC D
)
ááD E
{
àà 
if
ââ 
(
ââ 
CryptoHelpers
ââ %
.
ââ% &%
GetRandomPositiveDouble
ââ& =
(
ââ= >
$num
ââ> ?
)
ââ? @
>
ââA B
IdentityMatches
ââC R
)
ââR S
{
ää 
obj
ãã 
.
ãã 
Path
ãã  
=
ãã! "
Id
ãã# %
.
ãã% &
Item1
ãã& +
;
ãã+ ,
if
åå 
(
åå 
CryptoHelpers
åå )
.
åå) *%
GetRandomPositiveDouble
åå* A
(
ååA B
$num
ååB C
)
ååC D
>
ååE F
RowKeyMatches
ååG T
)
ååT U
{
çç 
obj
éé 
.
éé  
FileType
éé  (
=
éé) *
Id
éé+ -
.
éé- .
Item2
éé. 3
;
éé3 4
}
èè 
}
êê 
}
ëë 
	dbManager
ìì 
.
ìì 
Write
ìì 
(
ìì  
obj
ìì  #
,
ìì# $

RunTwoName
ìì% /
)
ìì/ 0
;
ìì0 1
BagOfObjects
îî 
.
îî 
Add
îî  
(
îî  !
obj
îî! $
)
îî$ %
;
îî% &
}
ïï 
)
ïï 
;
ïï 
}
ññ 	
[
òò 	
IterationCleanup
òò	 
]
òò 
public
ôô 
void
ôô 
IterationCleanup
ôô $
(
ôô$ %
)
ôô% &
{
öö 	
	dbManager
õõ 
.
õõ 
CloseDatabase
õõ #
(
õõ# $
)
õõ$ %
;
õõ% &
}
úú 	
[
ûû 	
IterationSetup
ûû	 
]
ûû 
public
üü 
void
üü 
IterationSetup
üü "
(
üü" #
)
üü# $
{
†† 	
Setup
°° 
(
°° 
)
°° 
;
°° 
}
¢¢ 	
public
©© 
void
©© 
PopulateDatabases
©© %
(
©©% &
)
©©& '
{
™™ 	
Setup
´´ 
(
´´ 
)
´´ 
;
´´ 
	dbManager
¨¨ 
.
¨¨ 
BeginTransaction
¨¨ &
(
¨¨& '
)
¨¨' (
;
¨¨( )
InsertFirstRun
ÆÆ 
(
ÆÆ 
)
ÆÆ 
;
ÆÆ 
InsertSecondRun
ØØ 
(
ØØ 
)
ØØ 
;
ØØ 
while
±± 
(
±± 
	dbManager
±± 
.
±± 
HasElements
±± (
)
±±( )
{
≤≤ 
Thread
≥≥ 
.
≥≥ 
Sleep
≥≥ 
(
≥≥ 
$num
≥≥ 
)
≥≥ 
;
≥≥  
}
¥¥ 
	dbManager
∂∂ 
.
∂∂ 
Commit
∂∂ 
(
∂∂ 
)
∂∂ 
;
∂∂ 
	dbManager
∑∑ 
.
∑∑ 
CloseDatabase
∑∑ #
(
∑∑# $
)
∑∑$ %
;
∑∑% &
}
∏∏ 	
private
ªª 
static
ªª 
readonly
ªª 
ConcurrentBag
ªª  -
<
ªª- .
(
ªª. /
string
ªª/ 5
,
ªª5 6
string
ªª7 =
)
ªª= >
>
ªª> ?
BagOfIdentities
ªª@ O
=
ªªP Q
new
ªªR U
ConcurrentBag
ªªV c
<
ªªc d
(
ªªd e
string
ªªe k
,
ªªk l
string
ªªm s
)
ªªs t
>
ªªt u
(
ªªu v
)
ªªv w
;
ªªw x
private
ΩΩ 
readonly
ΩΩ 
string
ΩΩ 

RunOneName
ΩΩ  *
=
ΩΩ+ ,
$str
ΩΩ- 5
;
ΩΩ5 6
private
ææ 
readonly
ææ 
string
ææ 

RunTwoName
ææ  *
=
ææ+ ,
$str
ææ- 5
;
ææ5 6
private
øø 
DatabaseManager
øø 
	dbManager
øø  )
;
øø) *
private
¡¡ 
void
¡¡ 
Setup
¡¡ 
(
¡¡ 
)
¡¡ 
{
¬¬ 	
	dbManager
√√ 
=
√√ 
new
√√ #
SqliteDatabaseManager
√√ 1
(
√√1 2
filename
√√2 :
:
√√: ;
$"
√√< >
$str
√√> K
{
√√K L
Shards
√√L R
}
√√R S
$str
√√S Z
"
√√Z [
,
√√[ \
new
√√] `

DBSettings
√√a k
(
√√k l
)
√√l m
{
ƒƒ 
JournalMode
≈≈ 
=
≈≈ 
JournalMode
≈≈ )
,
≈≈) *
LockingMode
∆∆ 
=
∆∆ 
LockingMode
∆∆ )
,
∆∆) *
PageSize
«« 
=
«« 
PageSize
«« #
,
««# $
ShardingFactor
»» 
=
»»  
Shards
»»! '
,
»»' (
Synchronous
…… 
=
…… 
Synchronous
…… )
}
   
)
   
;
   
	dbManager
ÀÀ 
.
ÀÀ 
Setup
ÀÀ 
(
ÀÀ 
)
ÀÀ 
;
ÀÀ 
}
ÃÃ 	
}
ÕÕ 
}ŒŒ ª:
GD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\SetupTimeTest.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .

Benchmarks. 8
{ 
[ %
MarkdownExporterAttribute 
. 
GitHub %
]% &
[		 !
JsonExporterAttribute		 
.		 
Full		 
]		  
public

 

class

 
SetupTimeTest

 
:

   
AsaDatabaseBenchmark

! 5
{ 
public 
SetupTimeTest 
( 
) 
{ 	
Logger 
. 
Setup 
( 
true 
, 
true #
)# $
;$ %
Strings 
. 
Setup 
( 
) 
; 
} 	
[ 	
Params	 
( 
$str 
, 
$str 
,  
$str! &
,& '
$str( 0
)0 1
]1 2
public 
string 
JournalMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Params	 
( 
$str 
, 
$str %
)% &
]& '
public 
string 
LockingMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Params	 
( 
$num 
) 
] 
public 
int 
ObjectPadding  
{! "
get# &
;& '
set( +
;+ ,
}- .
[!! 	
Params!!	 
(!! 
$num!! 
)!! 
]!! 
public"" 
int"" 
PageSize"" 
{"" 
get"" !
;""! "
set""# &
;""& '
}""( )
[%% 	
Params%%	 
(%% 
$num%% 
,%% 
$num%% 
,%% 
$num%% 
,%% 
$num%% 
,%% 
$num%% 
,%% 
$num%%  
,%%  !
$num%%" #
,%%# $
$num%%% &
,%%& '
$num%%( )
,%%) *
$num%%+ -
,%%- .
$num%%/ 1
,%%1 2
$num%%3 5
)%%5 6
]%%6 7
public&& 
int&& 
Shards&& 
{&& 
get&& 
;&&  
set&&! $
;&&$ %
}&&& '
[** 	
Params**	 
(** 
$num** 
,** 
$num** 
)** 
]** 
public++ 
int++ 
StartingSize++ 
{++  !
get++" %
;++% &
set++' *
;++* +
}++, -
[-- 	
Params--	 
(-- 
$str-- 
,-- 
$str-- 
)--  
]--  !
public.. 
string.. 
Synchronous.. !
{.." #
get..$ '
;..' (
set..) ,
;.., -
}... /
[00 	
GlobalCleanup00	 
]00 
public11 
void11 
GlobalCleanup11 !
(11! "
)11" #
{22 	
Setup33 
(33 
)33 
;33 
	dbManager44 
.44 
Destroy44 
(44 
)44 
;44  
}55 	
[77 	
GlobalSetup77	 
]77 
public88 
void88 
GlobalSetup88 
(88  
)88  !
{99 	
PopulateDatabases:: 
(:: 
):: 
;::  
};; 	
public== 
void== 
Insert_X_Objects== $
(==$ %
int==% (
X==) *
,==* +
int==, /
ObjectPadding==0 =
===> ?
$num==@ A
,==A B
string==C I
runName==J Q
===R S
$str==T f
)==f g
{>> 	
Parallel?? 
.?? 
For?? 
(?? 
$num?? 
,?? 
X?? 
,?? 
i??  
=>??! #
{@@ 
varAA 
objAA 
=AA 
GetRandomObjectAA )
(AA) *
ObjectPaddingAA* 7
)AA7 8
;AA8 9
	dbManagerBB 
.BB 
WriteBB 
(BB  
objBB  #
,BB# $
runNameBB% ,
)BB, -
;BB- .
BagOfObjectsCC 
.CC 
AddCC  
(CC  !
objCC! $
)CC$ %
;CC% &
}DD 
)DD 
;DD 
whileFF 
(FF 
	dbManagerFF 
.FF 
HasElementsFF (
)FF( )
{GG 
ThreadHH 
.HH 
SleepHH 
(HH 
$numHH 
)HH 
;HH  
}II 
}JJ 	
[LL 	
IterationCleanupLL	 
]LL 
publicMM 
voidMM 
IterationCleanupMM $
(MM$ %
)MM% &
{NN 	
	dbManagerOO 
.OO 
CloseDatabaseOO #
(OO# $
)OO$ %
;OO% &
}PP 	
[RR 	
IterationSetupRR	 
]RR 
publicSS 
voidSS 
IterationSetupSS "
(SS" #
)SS# $
{TT 	
}UU 	
publicWW 
voidWW 
PopulateDatabasesWW %
(WW% &
)WW& '
{XX 	
SetupYY 
(YY 
)YY 
;YY 
	dbManagerZZ 
.ZZ 
BeginTransactionZZ &
(ZZ& '
)ZZ' (
;ZZ( )
Insert_X_Objects\\ 
(\\ 
StartingSize\\ )
,\\) *
ObjectPadding\\+ 8
,\\8 9
$str\\: L
)\\L M
;\\M N
	dbManager^^ 
.^^ 
Commit^^ 
(^^ 
)^^ 
;^^ 
	dbManager__ 
.__ 
CloseDatabase__ #
(__# $
)__$ %
;__% &
}`` 	
privatebb 
DatabaseManagerbb 
	dbManagerbb  )
;bb) *
[dd 	
	Benchmarkdd	 
]dd 
privateee 
voidee 
Setupee 
(ee 
)ee 
{ff 	
	dbManagergg 
=gg 
newgg !
SqliteDatabaseManagergg 1
(gg1 2
filenamegg2 :
:gg: ;
$"gg< >
$strgg> K
{ggK L
ShardsggL R
}ggR S
$strggS Z
"ggZ [
,gg[ \
newgg] `

DBSettingsgga k
(ggk l
)ggl m
{hh 
JournalModeii 
=ii 
JournalModeii )
,ii) *
LockingModejj 
=jj 
LockingModejj )
,jj) *
PageSizekk 
=kk 
PageSizekk #
,kk# $
ShardingFactorll 
=ll  
Shardsll! '
,ll' (
Synchronousmm 
=mm 
Synchronousmm )
}nn 
)nn 
;nn 
	dbManagerpp 
.pp 
Setuppp 
(pp 
)pp 
;pp 
}qq 	
}rr 
}ss ‚ù
UD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\SystemSqliteDatabaseManager.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .
Utils. 3
{ 
public 

static 
class '
SystemSQLiteDatabaseManager 3
{ 
public 
static 
List 
< +
SystemSQLiteSqlConnectionHolder :
>: ;
Connections< G
{H I
getJ M
;M N
privateO V
setW Z
;Z [
}\ ]
=^ _
new` c
Listd h
<h i,
SystemSQLiteSqlConnectionHolder	i à
>
à â
(
â ä
)
ä ã
;
ã å
public 
static 
bool 
FirstRun #
{$ %
get& )
;) *
private+ 2
set3 6
;6 7
}8 9
=: ;
true< @
;@ A
public 
static +
SystemSQLiteSqlConnectionHolder 5
?5 6
MainConnection7 E
{ 	
get 
{ 
if 
( 
Connections 
.  
Any  #
(# $
)$ %
)% &
return 
Connections &
[& '
$num' (
]( )
;) *
return 
null 
; 
} 
} 	
public 
static 
string 
SQLiteFilename +
{, -
get. 1
;1 2
private3 :
set; >
;> ?
}@ A
=B C
$strD P
;P Q
public!! 
static!! 
void!! 
BeginTransaction!! +
(!!+ ,
)!!, -
{"" 	
Connections## 
.## 

AsParallel## "
(##" #
)### $
.##$ %
ForAll##% +
(##+ ,
cxn##, /
=>##0 2
cxn##3 6
.##6 7
BeginTransaction##7 G
(##G H
)##H I
)##I J
;##J K
}$$ 	
public&& 
static&& 
void&& 
CloseDatabase&& (
(&&( )
)&&) *
{'' 	
RollBack(( 
((( 
)(( 
;(( 
Connections)) 
.)) 

AsParallel)) "
())" #
)))# $
.))$ %
ForAll))% +
())+ ,
cxn)), /
=>))0 2
{** 
cxn++ 
.++ 
ShutDown++ 
(++ 
)++ 
;++ 
},, 
),, 
;,, 
Connections-- 
.-- 
	RemoveAll-- !
(--! "
_--" #
=>--$ &
true--' +
)--+ ,
;--, -
}.. 	
public00 
static00 
void00 
Commit00 !
(00! "
)00" #
{11 	
Connections22 
.22 

AsParallel22 "
(22" #
)22# $
.22$ %
ForAll22% +
(22+ ,
x22, -
=>22. 0
x221 2
.222 3
Commit223 9
(229 :
)22: ;
)22; <
;22< =
}33 	
public55 
static55 
void55 
	DeleteRun55 $
(55$ %
string55% +
runid55, 1
)551 2
{66 	
_77 
=77 
MainConnection77 
??77 !
throw77" '
new77( +"
NullReferenceException77, B
(77B C
Strings77C J
.77J K
Get77K N
(77N O
$str77O _
)77_ `
)77` a
;77a b
using88 
var88 
truncateRunsTable88 '
=88( )
new88* -
SQLiteCommand88. ;
(88; <
SQL_TRUNCATE_RUN88< L
,88L M
MainConnection88N \
.88\ ]

Connection88] g
,88g h
MainConnection88i w
.88w x
Transaction	88x É
)
88É Ñ
;
88Ñ Ö
truncateRunsTable99 
.99 

Parameters99 (
.99( )
AddWithValue99) 5
(995 6
$str996 ?
,99? @
runid99A F
)99F G
;99G H
truncateRunsTable:: 
.:: 
ExecuteNonQuery:: -
(::- .
)::. /
;::/ 0
Connections<< 
.<< 

AsParallel<< "
(<<" #
)<<# $
.<<$ %
ForAll<<% +
(<<+ ,
cxn<<, /
=><<0 2
{== 
using>> 
var>>  
truncateCollectTable>> .
=>>/ 0
new>>1 4
SQLiteCommand>>5 B
(>>B C
SQL_DELETE_RUN>>C Q
,>>Q R
cxn>>S V
.>>V W

Connection>>W a
,>>a b
cxn>>c f
.>>f g
Transaction>>g r
)>>r s
;>>s t 
truncateCollectTable?? $
.??$ %

Parameters??% /
.??/ 0
AddWithValue??0 <
(??< =
$str??= F
,??F G
runid??H M
)??M N
;??N O 
truncateCollectTable@@ $
.@@$ %
ExecuteNonQuery@@% 4
(@@4 5
)@@5 6
;@@6 7
}AA 
)AA 
;AA 
}BB 	
publicDD 
staticDD 
voidDD 
DestroyDD "
(DD" #
)DD# $
{EE 	
ConnectionsFF 
.FF 

AsParallelFF "
(FF" #
)FF# $
.FF$ %
ForAllFF% +
(FF+ ,
xFF, -
=>FF. 0
xFF1 2
.FF2 3
DestroyFF3 :
(FF: ;
)FF; <
)FF< =
;FF= >
ConnectionsGG 
.GG 
	RemoveAllGG !
(GG! "
xGG" #
=>GG$ &
trueGG' +
)GG+ ,
;GG, -
}HH 	
publicJJ 
staticJJ 
ListJJ 
<JJ 
RESULT_TYPEJJ &
>JJ& ' 
GetCommonResultTypesJJ( <
(JJ< =
stringJJ= C
baseIdJJD J
,JJJ K
stringJJL R
	compareIdJJS \
)JJ\ ]
{KK 	
varLL 
runOneLL 
=LL 
GetRunLL 
(LL  
baseIdLL  &
)LL& '
;LL' (
varMM 
runTwoMM 
=MM 
GetRunMM 
(MM  
	compareIdMM  )
)MM) *
;MM* +
returnOO 
runOneOO 
?OO 
.OO 
ResultTypesOO &
.OO& '
	IntersectOO' 0
(OO0 1
runTwoOO1 7
?OO7 8
.OO8 9
ResultTypesOO9 D
??OOE G
newOOH K
ListOOL P
<OOP Q
RESULT_TYPEOOQ \
>OO\ ]
(OO] ^
)OO^ _
)OO_ `
.OO` a
ToListOOa g
(OOg h
)OOh i
??OOj l
runTwoOOm s
?OOs t
.OOt u
ResultTypes	OOu Ä
??
OOÅ É
new
OOÑ á
List
OOà å
<
OOå ç
RESULT_TYPE
OOç ò
>
OOò ô
(
OOô ö
)
OOö õ
;
OOõ ú
}PP 	
publicRR 
staticRR 
boolRR "
GetComparisonCompletedRR 1
(RR1 2
stringRR2 8

firstRunIdRR9 C
,RRC D
stringRRE K
secondRunIdRRL W
)RRW X
{SS 	
ifTT 
(TT 
MainConnectionTT 
!=TT !
nullTT" &
)TT& '
{UU 
usingVV 
(VV 
varVV 
cmdVV 
=VV  
newVV! $
SQLiteCommandVV% 2
(VV2 38
,SQL_CHECK_IF_COMPARISON_PREVIOUSLY_COMPLETEDVV3 _
,VV_ `
MainConnectionVVa o
.VVo p

ConnectionVVp z
,VVz {
MainConnection	VV| ä
.
VVä ã
Transaction
VVã ñ
)
VVñ ó
)
VVó ò
{WW 
cmdXX 
.XX 

ParametersXX "
.XX" #
AddWithValueXX# /
(XX/ 0
$strXX0 >
,XX> ?

firstRunIdXX@ J
)XXJ K
;XXK L
cmdYY 
.YY 

ParametersYY "
.YY" #
AddWithValueYY# /
(YY/ 0
$strYY0 A
,YYA B
secondRunIdYYC N
)YYN O
;YYO P
usingZZ 
(ZZ 
varZZ 
readerZZ %
=ZZ& '
cmdZZ( +
.ZZ+ ,
ExecuteReaderZZ, 9
(ZZ9 :
)ZZ: ;
)ZZ; <
{[[ 
while\\ 
(\\ 
reader\\ %
.\\% &
Read\\& *
(\\* +
)\\+ ,
)\\, -
{]] 
return^^ "
true^^# '
;^^' (
}__ 
}`` 
}aa 
}bb 
elsecc 
{dd 
Logee 
.ee 
Debugee 
(ee 
$stree \
)ee\ ]
;ee] ^
}ff 
returnhh 
falsehh 
;hh 
}ii 	
publickk 
statickk 
Listkk 
<kk 
CompareResultkk (
>kk( ) 
GetComparisonResultskk* >
(kk> ?
stringkk? E
	compareIdkkF O
,kkO P
RESULT_TYPEkkQ \

exportTypekk] g
)kkg h
{ll 	
Listmm 
<mm 
CompareResultmm 
>mm 
recordsmm  '
=mm( )
newmm* -
Listmm. 2
<mm2 3
CompareResultmm3 @
>mm@ A
(mmA B
)mmB C
;mmC D
ifnn 
(nn 
MainConnectionnn 
!=nn !
nullnn" &
)nn& '
{oo 
usingpp 
(pp 
varpp 
cmdpp 
=pp  
newpp! $
SQLiteCommandpp% 2
(pp2 3"
GET_COMPARISON_RESULTSpp3 I
,ppI J
MainConnectionppK Y
.ppY Z

ConnectionppZ d
,ppd e
MainConnectionppf t
.ppt u
Transaction	ppu Ä
)
ppÄ Å
)
ppÅ Ç
{qq 
cmdrr 
.rr 

Parametersrr "
.rr" #
AddWithValuerr# /
(rr/ 0
$strrr0 @
,rr@ A
	compareIdrrB K
)rrK L
;rrL M
cmdss 
.ss 

Parametersss "
.ss" #
AddWithValuess# /
(ss/ 0
$strss0 >
,ss> ?

exportTypess@ J
)ssJ K
;ssK L
usingtt 
(tt 
vartt 
readertt %
=tt& '
cmdtt( +
.tt+ ,
ExecuteReadertt, 9
(tt9 :
)tt: ;
)tt; <
{uu 
whilevv 
(vv 
readervv %
.vv% &
Readvv& *
(vv* +
)vv+ ,
)vv, -
{ww 
ifxx 
(xx  
readerxx  &
[xx& '
$strxx' 3
]xx3 4
.xx4 5
ToStringxx5 =
(xx= >
)xx> ?
isxx@ B
stringxxC I

serializedxxJ T
)xxT U
{yy 
tryzz  #
{{{  !
records||$ +
.||+ ,
Add||, /
(||/ 0
JsonConvert||0 ;
.||; <
DeserializeObject||< M
<||M N
CompareResult||N [
>||[ \
(||\ ]

serialized||] g
)||g h
)||h i
;||i j
}}}  !
catch~~  %
(~~& '
	Exception~~' 0
e~~1 2
)~~2 3
{  !
Log
ÄÄ$ '
.
ÄÄ' (
Debug
ÄÄ( -
(
ÄÄ- .
e
ÄÄ. /
,
ÄÄ/ 0
$str
ÄÄ1 a
,
ÄÄa b

serialized
ÄÄc m
)
ÄÄm n
;
ÄÄn o
}
ÅÅ  !
}
ÇÇ 
}
ÉÉ 
}
ÑÑ 
}
ÖÖ 
}
ÜÜ 
return
áá 
records
áá 
;
áá 
}
àà 	
public
ää 
static
ää 
List
ää 
<
ää 
CompareResult
ää (
>
ää( )"
GetComparisonResults
ää* >
(
ää> ?
string
ää? E
comparisonId
ääF R
,
ääR S
int
ääT W

resultType
ääX b
,
ääb c
int
ääd g
offset
ääh n
,
ään o
int
ääp s

numResults
äät ~
)
ää~ 
{
ãã 	
_
åå 
=
åå 
MainConnection
åå 
??
åå !
throw
åå" '
new
åå( +$
NullReferenceException
åå, B
(
ååB C
Strings
ååC J
.
ååJ K
Get
ååK N
(
ååN O
$str
ååO _
)
åå_ `
)
åå` a
;
ååa b
var
çç 
results
çç 
=
çç 
new
çç 
List
çç "
<
çç" #
CompareResult
çç# 0
>
çç0 1
(
çç1 2
)
çç2 3
;
çç3 4
using
éé 
(
éé 
var
éé 
cmd
éé 
=
éé 
new
éé  
SQLiteCommand
éé! .
(
éé. /*
GET_COMPARISON_RESULTS_LIMIT
éé/ K
,
ééK L
MainConnection
ééM [
.
éé[ \

Connection
éé\ f
,
ééf g
MainConnection
ééh v
.
éév w
Transactionééw Ç
)ééÇ É
)ééÉ Ñ
{
èè 
cmd
êê 
.
êê 

Parameters
êê 
.
êê 
AddWithValue
êê +
(
êê+ ,
$str
êê, <
,
êê< =
comparisonId
êê> J
)
êêJ K
;
êêK L
cmd
ëë 
.
ëë 

Parameters
ëë 
.
ëë 
AddWithValue
ëë +
(
ëë+ ,
$str
ëë, :
,
ëë: ;

resultType
ëë< F
)
ëëF G
;
ëëG H
cmd
íí 
.
íí 

Parameters
íí 
.
íí 
AddWithValue
íí +
(
íí+ ,
$str
íí, 5
,
íí5 6
offset
íí7 =
)
íí= >
;
íí> ?
cmd
ìì 
.
ìì 

Parameters
ìì 
.
ìì 
AddWithValue
ìì +
(
ìì+ ,
$str
ìì, 4
,
ìì4 5

numResults
ìì6 @
)
ìì@ A
;
ììA B
using
îî 
(
îî 
var
îî 
reader
îî !
=
îî" #
cmd
îî$ '
.
îî' (
ExecuteReader
îî( 5
(
îî5 6
)
îî6 7
)
îî7 8
{
ïï 
while
ññ 
(
ññ 
reader
ññ !
.
ññ! "
Read
ññ" &
(
ññ& '
)
ññ' (
)
ññ( )
{
óó 
try
òò 
{
ôô 
var
öö 
thing
öö  %
=
öö& '
reader
öö( .
[
öö. /
$str
öö/ ;
]
öö; <
;
öö< =
if
õõ 
(
õõ  
thing
õõ  %
is
õõ& (
string
õõ) /
result
õõ0 6
)
õõ6 7
{
úú 
var
ùù  #
obj
ùù$ '
=
ùù( )
JsonConvert
ùù* 5
.
ùù5 6
DeserializeObject
ùù6 G
<
ùùG H
CompareResult
ùùH U
>
ùùU V
(
ùùV W
result
ùùW ]
)
ùù] ^
;
ùù^ _
results
ûû  '
.
ûû' (
Add
ûû( +
(
ûû+ ,
obj
ûû, /
)
ûû/ 0
;
ûû0 1
}
üü 
}
†† 
catch
°° 
(
°° 
	Exception
°° (
e
°°) *
)
°°* +
{
¢¢ 
Log
££ 
.
££  
Debug
££  %
(
££% &
e
££& '
,
££' (
$str
££) B
,
££B C
reader
££D J
[
££J K
$str
££K W
]
££W X
)
££X Y
;
££Y Z
}
§§ 
}
•• 
}
¶¶ 
}
ßß 
return
©© 
results
©© 
;
©© 
}
™™ 	
public
¨¨ 
static
¨¨ 
int
¨¨ '
GetComparisonResultsCount
¨¨ 3
(
¨¨3 4
string
¨¨4 :
comparisonId
¨¨; G
,
¨¨G H
int
¨¨I L

resultType
¨¨M W
)
¨¨W X
{
≠≠ 	
_
ÆÆ 
=
ÆÆ 
MainConnection
ÆÆ 
??
ÆÆ !
throw
ÆÆ" '
new
ÆÆ( +$
NullReferenceException
ÆÆ, B
(
ÆÆB C
Strings
ÆÆC J
.
ÆÆJ K
Get
ÆÆK N
(
ÆÆN O
$str
ÆÆO _
)
ÆÆ_ `
)
ÆÆ` a
;
ÆÆa b
var
ØØ 
result_count
ØØ 
=
ØØ 
$num
ØØ  
;
ØØ  !
using
∞∞ 
(
∞∞ 
var
∞∞ 
cmd
∞∞ 
=
∞∞ 
new
∞∞  
SQLiteCommand
∞∞! .
(
∞∞. /
GET_RESULT_COUNT
∞∞/ ?
,
∞∞? @
MainConnection
∞∞A O
.
∞∞O P

Connection
∞∞P Z
,
∞∞Z [
MainConnection
∞∞\ j
.
∞∞j k
Transaction
∞∞k v
)
∞∞v w
)
∞∞w x
{
±± 
cmd
≤≤ 
.
≤≤ 

Parameters
≤≤ 
.
≤≤ 
AddWithValue
≤≤ +
(
≤≤+ ,
$str
≤≤, <
,
≤≤< =
comparisonId
≤≤> J
)
≤≤J K
;
≤≤K L
cmd
≥≥ 
.
≥≥ 

Parameters
≥≥ 
.
≥≥ 
AddWithValue
≥≥ +
(
≥≥+ ,
$str
≥≥, :
,
≥≥: ;

resultType
≥≥< F
)
≥≥F G
;
≥≥G H
using
¥¥ 
(
¥¥ 
var
¥¥ 
reader
¥¥ !
=
¥¥" #
cmd
¥¥$ '
.
¥¥' (
ExecuteReader
¥¥( 5
(
¥¥5 6
)
¥¥6 7
)
¥¥7 8
{
µµ 
while
∂∂ 
(
∂∂ 
reader
∂∂ !
.
∂∂! "
Read
∂∂" &
(
∂∂& '
)
∂∂' (
)
∂∂( )
{
∑∑ 
if
∏∏ 
(
∏∏ 
reader
∏∏ "
[
∏∏" #
$str
∏∏# -
]
∏∏- .
.
∏∏. /
ToString
∏∏/ 7
(
∏∏7 8
)
∏∏8 9
is
∏∏: <
string
∏∏= C
integer
∏∏D K
)
∏∏K L
result_count
ππ (
=
ππ) *
int
ππ+ .
.
ππ. /
Parse
ππ/ 4
(
ππ4 5
integer
ππ5 <
,
ππ< =
CultureInfo
ππ> I
.
ππI J
InvariantCulture
ππJ Z
)
ππZ [
;
ππ[ \
}
∫∫ 
}
ªª 
}
ºº 
return
ΩΩ 
result_count
ΩΩ 
;
ΩΩ  
}
ææ 	
public
¿¿ 
static
¿¿ 
List
¿¿ 
<
¿¿ 
string
¿¿ !
>
¿¿! "
GetLatestRunIds
¿¿# 2
(
¿¿2 3
int
¿¿3 6
numberOfIds
¿¿7 B
,
¿¿B C
string
¿¿D J
type
¿¿K O
)
¿¿O P
{
¡¡ 	
List
¬¬ 
<
¬¬ 
string
¬¬ 
>
¬¬ 
output
¬¬ 
=
¬¬  !
new
¬¬" %
List
¬¬& *
<
¬¬* +
string
¬¬+ 1
>
¬¬1 2
(
¬¬2 3
)
¬¬3 4
;
¬¬4 5
if
√√ 
(
√√ 
MainConnection
√√ 
!=
√√ !
null
√√" &
)
√√& '
{
ƒƒ 
using
≈≈ 
(
≈≈ 
var
≈≈ 
cmd
≈≈ 
=
≈≈  
new
≈≈! $
SQLiteCommand
≈≈% 2
(
≈≈2 3&
SQL_SELECT_LATEST_N_RUNS
≈≈3 K
,
≈≈K L
MainConnection
≈≈M [
.
≈≈[ \

Connection
≈≈\ f
,
≈≈f g
MainConnection
≈≈h v
.
≈≈v w
Transaction≈≈w Ç
)≈≈Ç É
)≈≈É Ñ
{
∆∆ 
cmd
«« 
.
«« 

Parameters
«« "
.
««" #
AddWithValue
««# /
(
««/ 0
$str
««0 7
,
««7 8
type
««9 =
)
««= >
;
««> ?
cmd
»» 
.
»» 

Parameters
»» "
.
»»" #
AddWithValue
»»# /
(
»»/ 0
$str
»»0 8
,
»»8 9
numberOfIds
»»: E
)
»»E F
;
»»F G
try
…… 
{
   
using
ÀÀ 
(
ÀÀ 
var
ÀÀ "
reader
ÀÀ# )
=
ÀÀ* +
cmd
ÀÀ, /
.
ÀÀ/ 0
ExecuteReader
ÀÀ0 =
(
ÀÀ= >
)
ÀÀ> ?
)
ÀÀ? @
{
ÃÃ 
while
ÕÕ !
(
ÕÕ" #
reader
ÕÕ# )
.
ÕÕ) *
Read
ÕÕ* .
(
ÕÕ. /
)
ÕÕ/ 0
)
ÕÕ0 1
{
ŒŒ 
var
œœ  #
str
œœ$ '
=
œœ( )
reader
œœ* 0
[
œœ0 1
$str
œœ1 9
]
œœ9 :
.
œœ: ;
ToString
œœ; C
(
œœC D
)
œœD E
;
œœE F
if
––  "
(
––# $
!
––$ %
string
––% +
.
––+ ,
IsNullOrEmpty
––, 9
(
––9 :
str
––: =
)
––= >
)
––> ?
output
——$ *
.
——* +
Add
——+ .
(
——. /
str
——/ 2
)
——2 3
;
——3 4
}
““ 
}
”” 
}
‘‘ 
catch
’’ 
(
’’ 
SQLiteException
’’ *
)
’’* +
{
÷÷ 
Log
◊◊ 
.
◊◊ 
Debug
◊◊ !
(
◊◊! "
$str
◊◊" J
,
◊◊J K
numberOfIds
◊◊L W
)
◊◊W X
;
◊◊X Y
}
ÿÿ 
}
ŸŸ 
}
⁄⁄ 
else
€€ 
{
‹‹ 
Log
›› 
.
›› 
Debug
›› 
(
›› 
$str
›› U
)
››U V
;
››V W
}
ﬁﬁ 
return
ﬂﬂ 
output
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 	
public
‚‚ 
static
‚‚ 
ConcurrentBag
‚‚ #
<
‚‚# $
WriteObject
‚‚$ /
>
‚‚/ 0!
GetMissingFromFirst
‚‚1 D
(
‚‚D E
string
‚‚E K

firstRunId
‚‚L V
,
‚‚V W
string
‚‚X ^
secondRunId
‚‚_ j
)
‚‚j k
{
„„ 	
var
‰‰ 
output
‰‰ 
=
‰‰ 
new
‰‰ 
ConcurrentBag
‰‰ *
<
‰‰* +
WriteObject
‰‰+ 6
>
‰‰6 7
(
‰‰7 8
)
‰‰8 9
;
‰‰9 :
Connections
ÊÊ 
.
ÊÊ 

AsParallel
ÊÊ "
(
ÊÊ" #
)
ÊÊ# $
.
ÊÊ$ %
ForAll
ÊÊ% +
(
ÊÊ+ ,
cxn
ÊÊ, /
=>
ÊÊ0 2
{
ÁÁ 
using
ËË 
var
ËË 
cmd
ËË 
=
ËË 
new
ËË  #
SQLiteCommand
ËË$ 1
(
ËË1 2*
SQL_GET_COLLECT_MISSING_IN_B
ËË2 N
,
ËËN O
cxn
ËËP S
.
ËËS T

Connection
ËËT ^
,
ËË^ _
cxn
ËË` c
.
ËËc d
Transaction
ËËd o
)
ËËo p
;
ËËp q
cmd
ÈÈ 
.
ÈÈ 

Parameters
ÈÈ 
.
ÈÈ 
AddWithValue
ÈÈ +
(
ÈÈ+ ,
$str
ÈÈ, ;
,
ÈÈ; <

firstRunId
ÈÈ= G
)
ÈÈG H
;
ÈÈH I
cmd
ÍÍ 
.
ÍÍ 

Parameters
ÍÍ 
.
ÍÍ 
AddWithValue
ÍÍ +
(
ÍÍ+ ,
$str
ÍÍ, <
,
ÍÍ< =
secondRunId
ÍÍ> I
)
ÍÍI J
;
ÍÍJ K
using
ÎÎ 
(
ÎÎ 
var
ÎÎ 
reader
ÎÎ !
=
ÎÎ" #
cmd
ÎÎ$ '
.
ÎÎ' (
ExecuteReader
ÎÎ( 5
(
ÎÎ5 6
)
ÎÎ6 7
)
ÎÎ7 8
while
ÏÏ 
(
ÏÏ 
reader
ÏÏ !
.
ÏÏ! "
Read
ÏÏ" &
(
ÏÏ& '
)
ÏÏ' (
)
ÏÏ( )
{
ÌÌ 
var
ÓÓ 
runId
ÓÓ !
=
ÓÓ" #
reader
ÓÓ$ *
[
ÓÓ* +
$str
ÓÓ+ 3
]
ÓÓ3 4
.
ÓÓ4 5
ToString
ÓÓ5 =
(
ÓÓ= >
)
ÓÓ> ?
;
ÓÓ? @
var
ÔÔ 
resultTypeString
ÔÔ ,
=
ÔÔ- .
reader
ÔÔ/ 5
[
ÔÔ5 6
$str
ÔÔ6 C
]
ÔÔC D
.
ÔÔD E
ToString
ÔÔE M
(
ÔÔM N
)
ÔÔN O
;
ÔÔO P
if
 
(
 
runId
 !
!=
" $
null
% )
&&
* ,
resultTypeString
- =
!=
> @
null
A E
)
E F
{
ÒÒ 
var
ÚÚ 
wo
ÚÚ  "
=
ÚÚ# $
WriteObject
ÚÚ% 0
.
ÚÚ0 1

FromString
ÚÚ1 ;
(
ÚÚ; <
(
ÚÚ< =
string
ÚÚ= C
)
ÚÚC D
reader
ÚÚD J
[
ÚÚJ K
$str
ÚÚK W
]
ÚÚW X
,
ÚÚX Y
(
ÚÚZ [
RESULT_TYPE
ÚÚ[ f
)
ÚÚf g
Enum
ÚÚg k
.
ÚÚk l
Parse
ÚÚl q
(
ÚÚq r
typeof
ÚÚr x
(
ÚÚx y
RESULT_TYPEÚÚy Ñ
)ÚÚÑ Ö
,ÚÚÖ Ü 
resultTypeStringÚÚá ó
)ÚÚó ò
,ÚÚò ô
runIdÚÚö ü
)ÚÚü †
;ÚÚ† °
if
ÛÛ 
(
ÛÛ  
wo
ÛÛ  "
is
ÛÛ# %
WriteObject
ÛÛ& 1
WO
ÛÛ2 4
)
ÛÛ4 5
{
ÙÙ 
output
ıı  &
.
ıı& '
Add
ıı' *
(
ıı* +
WO
ıı+ -
)
ıı- .
;
ıı. /
}
ˆˆ 
}
˜˜ 
}
¯¯ 
}
˘˘ 
)
˘˘ 
;
˘˘ 
return
˚˚ 
output
˚˚ 
;
˚˚ 
}
¸¸ 	
public
˛˛ 
static
˛˛ 
ConcurrentBag
˛˛ #
<
˛˛# $
(
˛˛$ %
WriteObject
˛˛% 0
,
˛˛0 1
WriteObject
˛˛2 =
)
˛˛= >
>
˛˛> ?
GetModified
˛˛@ K
(
˛˛K L
string
˛˛L R

firstRunId
˛˛S ]
,
˛˛] ^
string
˛˛_ e
secondRunId
˛˛f q
)
˛˛q r
{
ˇˇ 	
var
ÄÄ 
output
ÄÄ 
=
ÄÄ 
new
ÄÄ 
ConcurrentBag
ÄÄ *
<
ÄÄ* +
(
ÄÄ+ ,
WriteObject
ÄÄ, 7
,
ÄÄ7 8
WriteObject
ÄÄ9 D
)
ÄÄD E
>
ÄÄE F
(
ÄÄF G
)
ÄÄG H
;
ÄÄH I
Connections
ÇÇ 
.
ÇÇ 

AsParallel
ÇÇ "
(
ÇÇ" #
)
ÇÇ# $
.
ÇÇ$ %
ForAll
ÇÇ% +
(
ÇÇ+ ,
cxn
ÇÇ, /
=>
ÇÇ0 2
{
ÉÉ 
using
ÑÑ 
var
ÑÑ 
cmd
ÑÑ 
=
ÑÑ 
new
ÑÑ  #
SQLiteCommand
ÑÑ$ 1
(
ÑÑ1 2&
SQL_GET_COLLECT_MODIFIED
ÑÑ2 J
,
ÑÑJ K
cxn
ÑÑL O
.
ÑÑO P

Connection
ÑÑP Z
,
ÑÑZ [
cxn
ÑÑ\ _
.
ÑÑ_ `
Transaction
ÑÑ` k
)
ÑÑk l
;
ÑÑl m
cmd
ÖÖ 
.
ÖÖ 

Parameters
ÖÖ 
.
ÖÖ 
AddWithValue
ÖÖ +
(
ÖÖ+ ,
$str
ÖÖ, ;
,
ÖÖ; <

firstRunId
ÖÖ= G
)
ÖÖG H
;
ÖÖH I
cmd
ÜÜ 
.
ÜÜ 

Parameters
ÜÜ 
.
ÜÜ 
AddWithValue
ÜÜ +
(
ÜÜ+ ,
$str
ÜÜ, <
,
ÜÜ< =
secondRunId
ÜÜ> I
)
ÜÜI J
;
ÜÜJ K
using
áá 
(
áá 
var
áá 
reader
áá !
=
áá" #
cmd
áá$ '
.
áá' (
ExecuteReader
áá( 5
(
áá5 6
)
áá6 7
)
áá7 8
{
àà 
while
ââ 
(
ââ 
reader
ââ !
.
ââ! "
Read
ââ" &
(
ââ& '
)
ââ' (
)
ââ( )
{
ää 
var
ãã 
aRunId
ãã "
=
ãã# $
reader
ãã% +
[
ãã+ ,
$str
ãã, 6
]
ãã6 7
.
ãã7 8
ToString
ãã8 @
(
ãã@ A
)
ããA B
;
ããB C
var
åå 
bRunId
åå "
=
åå# $
reader
åå% +
[
åå+ ,
$str
åå, 6
]
åå6 7
.
åå7 8
ToString
åå8 @
(
åå@ A
)
ååA B
;
ååB C
var
çç 
aResultType
çç '
=
çç( )
reader
çç* 0
[
çç0 1
$str
çç1 @
]
çç@ A
.
ççA B
ToString
ççB J
(
ççJ K
)
ççK L
;
ççL M
var
éé 
bResultType
éé '
=
éé( )
reader
éé* 0
[
éé0 1
$str
éé1 @
]
éé@ A
.
ééA B
ToString
ééB J
(
ééJ K
)
ééK L
;
ééL M
if
êê 
(
êê 
aRunId
êê "
!=
êê# %
null
êê& *
&&
êê+ -
bRunId
êê. 4
!=
êê5 7
null
êê8 <
&&
êê= ?
aResultType
êê@ K
!=
êêL N
null
êêO S
&&
êêT V
bResultType
êêW b
!=
êêc e
null
êêf j
)
êêj k
{
ëë 
var
íí 
val1
íí  $
=
íí% &
WriteObject
íí' 2
.
íí2 3

FromString
íí3 =
(
íí= >
(
íí> ?
string
íí? E
)
ííE F
reader
ííF L
[
ííL M
$str
ííM [
]
íí[ \
,
íí\ ]
(
íí^ _
RESULT_TYPE
íí_ j
)
ííj k
Enum
íík o
.
íío p
Parse
ííp u
(
ííu v
typeof
íív |
(
íí| }
RESULT_TYPEíí} à
)ííà â
,ííâ ä
aResultTypeííã ñ
)ííñ ó
,ííó ò
aRunIdííô ü
)ííü †
;íí† °
var
ìì 
val2
ìì  $
=
ìì% &
WriteObject
ìì' 2
.
ìì2 3

FromString
ìì3 =
(
ìì= >
(
ìì> ?
string
ìì? E
)
ììE F
reader
ììF L
[
ììL M
$str
ììM [
]
ìì[ \
,
ìì\ ]
(
ìì^ _
RESULT_TYPE
ìì_ j
)
ììj k
Enum
ììk o
.
ììo p
Parse
ììp u
(
ììu v
typeof
ììv |
(
ìì| }
RESULT_TYPEìì} à
)ììà â
,ììâ ä
bResultTypeììã ñ
)ììñ ó
,ììó ò
bRunIdììô ü
)ììü †
;ìì† °
if
ïï 
(
ïï  
val1
ïï  $
is
ïï% '
WriteObject
ïï( 3
V1
ïï4 6
&&
ïï7 9
val2
ïï: >
is
ïï? A
WriteObject
ïïB M
V2
ïïN P
)
ïïP Q
{
ññ 
output
óó  &
.
óó& '
Add
óó' *
(
óó* +
(
óó+ ,
V1
óó, .
,
óó. /
V2
óó0 2
)
óó2 3
)
óó3 4
;
óó4 5
}
òò 
}
ôô 
}
öö 
}
õõ 
}
úú 
)
úú 
;
úú 
return
ûû 
output
ûû 
;
ûû 
}
üü 	
public
°° 
static
°° 
List
°° 
<
°° %
OutputFileMonitorResult
°° 2
>
°°2 3
GetMonitorResults
°°4 E
(
°°E F
string
°°F L
runId
°°M R
,
°°R S
int
°°T W
offset
°°X ^
,
°°^ _
int
°°` c

numResults
°°d n
)
°°n o
{
¢¢ 	
var
££ 
results
££ 
=
££ 
new
££ 
List
££ "
<
££" #%
OutputFileMonitorResult
££# :
>
££: ;
(
££; <
)
££< =
;
££= >
if
§§ 
(
§§ 
MainConnection
§§ 
!=
§§ !
null
§§" &
)
§§& '
{
•• 
using
¶¶ 
(
¶¶ 
var
¶¶ 
cmd
¶¶ 
=
¶¶  
new
¶¶! $
SQLiteCommand
¶¶% 2
(
¶¶2 3!
GET_MONITOR_RESULTS
¶¶3 F
,
¶¶F G
MainConnection
¶¶H V
.
¶¶V W

Connection
¶¶W a
,
¶¶a b
MainConnection
¶¶c q
.
¶¶q r
Transaction
¶¶r }
)
¶¶} ~
)
¶¶~ 
{
ßß 
cmd
®® 
.
®® 

Parameters
®® "
.
®®" #
AddWithValue
®®# /
(
®®/ 0
$str
®®0 9
,
®®9 :
runId
®®; @
)
®®@ A
;
®®A B
cmd
©© 
.
©© 

Parameters
©© "
.
©©" #
AddWithValue
©©# /
(
©©/ 0
$str
©©0 9
,
©©9 :
offset
©©; A
)
©©A B
;
©©B C
cmd
™™ 
.
™™ 

Parameters
™™ "
.
™™" #
AddWithValue
™™# /
(
™™/ 0
$str
™™0 8
,
™™8 9

numResults
™™: D
)
™™D E
;
™™E F
using
´´ 
(
´´ 
var
´´ 
reader
´´ %
=
´´& '
cmd
´´( +
.
´´+ ,
ExecuteReader
´´, 9
(
´´9 :
)
´´: ;
)
´´; <
{
¨¨ 
while
≠≠ 
(
≠≠ 
reader
≠≠ %
.
≠≠% &
Read
≠≠& *
(
≠≠* +
)
≠≠+ ,
)
≠≠, -
{
ÆÆ 
var
ØØ 
path
ØØ  $
=
ØØ% &
reader
ØØ' -
[
ØØ- .
$str
ØØ. 4
]
ØØ4 5
.
ØØ5 6
ToString
ØØ6 >
(
ØØ> ?
)
ØØ? @
;
ØØ@ A
if
∞∞ 
(
∞∞  
!
∞∞  !
string
∞∞! '
.
∞∞' (
IsNullOrEmpty
∞∞( 5
(
∞∞5 6
path
∞∞6 :
)
∞∞: ;
)
∞∞; <
{
±± 
var
≤≤  #
obj
≤≤$ '
=
≤≤( )
new
≤≤* -%
OutputFileMonitorResult
≤≤. E
(
≤≤E F
path
≤≤F J
)
≤≤J K
{
≥≥  !
RowKey
¥¥$ *
=
¥¥+ ,
reader
¥¥- 3
[
¥¥3 4
$str
¥¥4 =
]
¥¥= >
.
¥¥> ?
ToString
¥¥? G
(
¥¥G H
)
¥¥H I
,
¥¥I J
	Timestamp
µµ$ -
=
µµ. /
reader
µµ0 6
[
µµ6 7
$str
µµ7 B
]
µµB C
.
µµC D
ToString
µµD L
(
µµL M
)
µµM N
,
µµN O
OldPath
∂∂$ +
=
∂∂, -
reader
∂∂. 4
[
∂∂4 5
$str
∂∂5 ?
]
∂∂? @
.
∂∂@ A
ToString
∂∂A I
(
∂∂I J
)
∂∂J K
,
∂∂K L
Name
∑∑$ (
=
∑∑) *
reader
∑∑+ 1
[
∑∑1 2
$str
∑∑2 8
]
∑∑8 9
.
∑∑9 :
ToString
∑∑: B
(
∑∑B C
)
∑∑C D
,
∑∑D E
OldName
∏∏$ +
=
∏∏, -
reader
∏∏. 4
[
∏∏4 5
$str
∏∏5 ?
]
∏∏? @
.
∏∏@ A
ToString
∏∏A I
(
∏∏I J
)
∏∏J K
,
∏∏K L

ChangeType
ππ$ .
=
ππ/ 0
(
ππ1 2
CHANGE_TYPE
ππ2 =
)
ππ= >
int
ππ> A
.
ππA B
Parse
ππB G
(
ππG H
reader
ππH N
[
ππN O
$str
ππO \
]
ππ\ ]
.
ππ] ^
ToString
ππ^ f
(
ππf g
)
ππg h
??
ππi k
$str
ππl u
,
ππu v
CultureInfoππw Ç
.ππÇ É 
InvariantCultureππÉ ì
)ππì î
,ππî ï
}
∫∫  !
;
∫∫! "
results
ªª  '
.
ªª' (
Add
ªª( +
(
ªª+ ,
obj
ªª, /
)
ªª/ 0
;
ªª0 1
}
ºº 
}
ΩΩ 
}
ææ 
}
øø 
}
¿¿ 
else
¡¡ 
{
¬¬ 
Log
√√ 
.
√√ 
Debug
√√ 
(
√√ 
$str
√√ Q
)
√√Q R
;
√√R S
}
ƒƒ 
return
∆∆ 
results
∆∆ 
;
∆∆ 
}
«« 	
public
…… 
static
…… 
List
…… 
<
…… 
string
…… !
>
……! "
GetMonitorRuns
……# 1
(
……1 2
)
……2 3
{
   	
return
ÀÀ 
GetRuns
ÀÀ 
(
ÀÀ 
$str
ÀÀ $
)
ÀÀ$ %
;
ÀÀ% &
}
ÃÃ 	
public
ŒŒ 
static
ŒŒ 
int
ŒŒ "
GetNumMonitorResults
ŒŒ .
(
ŒŒ. /
string
ŒŒ/ 5
runId
ŒŒ6 ;
)
ŒŒ; <
{
œœ 	
_
–– 
=
–– 
MainConnection
–– 
??
–– !
throw
––" '
new
––( +$
NullReferenceException
––, B
(
––B C
Strings
––C J
.
––J K
Get
––K N
(
––N O
$str
––O _
)
––_ `
)
––` a
;
––a b
using
““ 
(
““ 
var
““ 
cmd
““ 
=
““ 
new
““  
SQLiteCommand
““! .
(
““. /(
GET_RESULT_COUNT_MONITORED
““/ I
,
““I J
MainConnection
““K Y
.
““Y Z

Connection
““Z d
,
““d e
MainConnection
““f t
.
““t u
Transaction““u Ä
)““Ä Å
)““Å Ç
{
”” 
cmd
‘‘ 
.
‘‘ 

Parameters
‘‘ 
.
‘‘ 
AddWithValue
‘‘ +
(
‘‘+ ,
$str
‘‘, 5
,
‘‘5 6
runId
‘‘7 <
)
‘‘< =
;
‘‘= >
using
’’ 
(
’’ 
var
’’ 
reader
’’ !
=
’’" #
cmd
’’$ '
.
’’' (
ExecuteReader
’’( 5
(
’’5 6
)
’’6 7
)
’’7 8
{
÷÷ 
while
◊◊ 
(
◊◊ 
reader
◊◊ !
.
◊◊! "
Read
◊◊" &
(
◊◊& '
)
◊◊' (
)
◊◊( )
{
ÿÿ 
if
ŸŸ 
(
ŸŸ 
reader
ŸŸ "
[
ŸŸ" #
$str
ŸŸ# -
]
ŸŸ- .
.
ŸŸ. /
ToString
ŸŸ/ 7
(
ŸŸ7 8
)
ŸŸ8 9
is
ŸŸ: <
string
ŸŸ= C
integer
ŸŸD K
)
ŸŸK L
return
⁄⁄ "
int
⁄⁄# &
.
⁄⁄& '
Parse
⁄⁄' ,
(
⁄⁄, -
integer
⁄⁄- 4
,
⁄⁄4 5
CultureInfo
⁄⁄6 A
.
⁄⁄A B
InvariantCulture
⁄⁄B R
)
⁄⁄R S
;
⁄⁄S T
}
€€ 
}
‹‹ 
}
›› 
return
ﬂﬂ 
$num
ﬂﬂ 
;
ﬂﬂ 
}
‡‡ 	
public
‚‚ 
static
‚‚ 
int
‚‚ 
GetNumResults
‚‚ '
(
‚‚' (
RESULT_TYPE
‚‚( 3

ResultType
‚‚4 >
,
‚‚> ?
string
‚‚@ F
runId
‚‚G L
)
‚‚L M
{
„„ 	
try
‰‰ 
{
ÂÂ 
if
ÊÊ 
(
ÊÊ 
MainConnection
ÊÊ "
!=
ÊÊ# %
null
ÊÊ& *
)
ÊÊ* +
{
ÁÁ 
using
ËË 
(
ËË 
var
ËË 
cmd
ËË "
=
ËË# $
new
ËË% (
SQLiteCommand
ËË) 6
(
ËË6 7!
SQL_GET_NUM_RESULTS
ËË7 J
,
ËËJ K
MainConnection
ËËL Z
.
ËËZ [

Connection
ËË[ e
,
ËËe f
MainConnection
ËËg u
.
ËËu v
TransactionËËv Å
)ËËÅ Ç
)ËËÇ É
{
ÈÈ 
cmd
ÍÍ 
.
ÍÍ 

Parameters
ÍÍ &
.
ÍÍ& '
AddWithValue
ÍÍ' 3
(
ÍÍ3 4
$str
ÍÍ4 =
,
ÍÍ= >
runId
ÍÍ? D
)
ÍÍD E
;
ÍÍE F
cmd
ÎÎ 
.
ÎÎ 

Parameters
ÎÎ &
.
ÎÎ& '
AddWithValue
ÎÎ' 3
(
ÎÎ3 4
$str
ÎÎ4 B
,
ÎÎB C

ResultType
ÎÎD N
.
ÎÎN O
ToString
ÎÎO W
(
ÎÎW X
)
ÎÎX Y
)
ÎÎY Z
;
ÎÎZ [
using
ÌÌ 
(
ÌÌ 
var
ÌÌ "
reader
ÌÌ# )
=
ÌÌ* +
cmd
ÌÌ, /
.
ÌÌ/ 0
ExecuteReader
ÌÌ0 =
(
ÌÌ= >
)
ÌÌ> ?
)
ÌÌ? @
{
ÓÓ 
while
ÔÔ !
(
ÔÔ" #
reader
ÔÔ# )
.
ÔÔ) *
Read
ÔÔ* .
(
ÔÔ. /
)
ÔÔ/ 0
)
ÔÔ0 1
{
 
return
ÒÒ  &
int
ÒÒ' *
.
ÒÒ* +
Parse
ÒÒ+ 0
(
ÒÒ0 1
reader
ÒÒ1 7
[
ÒÒ7 8
$str
ÒÒ8 C
]
ÒÒC D
.
ÒÒD E
ToString
ÒÒE M
(
ÒÒM N
)
ÒÒN O
??
ÒÒP R
$str
ÒÒS W
,
ÒÒW X
CultureInfo
ÒÒY d
.
ÒÒd e
InvariantCulture
ÒÒe u
)
ÒÒu v
;
ÒÒv w
}
ÚÚ 
}
ÛÛ 
}
ÙÙ 
}
ıı 
}
ˆˆ 
catch
˜˜ 
(
˜˜ 
SQLiteException
˜˜ "
)
˜˜" #
{
¯¯ 
Log
˘˘ 
.
˘˘ 
Error
˘˘ 
(
˘˘ 
Strings
˘˘ !
.
˘˘! "
Get
˘˘" %
(
˘˘% &
$str
˘˘& /
)
˘˘/ 0
,
˘˘0 1

MethodBase
˘˘2 <
.
˘˘< =
GetCurrentMethod
˘˘= M
(
˘˘M N
)
˘˘N O
?
˘˘O P
.
˘˘P Q
Name
˘˘Q U
)
˘˘U V
;
˘˘V W
}
˙˙ 
return
˚˚ 
-
˚˚ 
$num
˚˚ 
;
˚˚ 
}
¸¸ 	
public
˛˛ 
static
˛˛ 
List
˛˛ 
<
˛˛ 
DataRunModel
˛˛ '
>
˛˛' (
GetResultModels
˛˛) 8
(
˛˛8 9

RUN_STATUS
˛˛9 C
	runStatus
˛˛D M
)
˛˛M N
{
ˇˇ 	
var
ÄÄ 
output
ÄÄ 
=
ÄÄ 
new
ÄÄ 
List
ÄÄ !
<
ÄÄ! "
DataRunModel
ÄÄ" .
>
ÄÄ. /
(
ÄÄ/ 0
)
ÄÄ0 1
;
ÄÄ1 2
if
ÇÇ 
(
ÇÇ 
MainConnection
ÇÇ 
!=
ÇÇ !
null
ÇÇ" &
)
ÇÇ& '
{
ÉÉ 
using
ÑÑ 
(
ÑÑ 
var
ÑÑ 
cmd
ÑÑ 
=
ÑÑ  
new
ÑÑ! $
SQLiteCommand
ÑÑ% 2
(
ÑÑ2 3 
SQL_QUERY_ANALYZED
ÑÑ3 E
,
ÑÑE F
MainConnection
ÑÑG U
.
ÑÑU V

Connection
ÑÑV `
,
ÑÑ` a
MainConnection
ÑÑb p
.
ÑÑp q
Transaction
ÑÑq |
)
ÑÑ| }
)
ÑÑ} ~
{
ÖÖ 
cmd
ÜÜ 
.
ÜÜ 

Parameters
ÜÜ "
.
ÜÜ" #
AddWithValue
ÜÜ# /
(
ÜÜ/ 0
$str
ÜÜ0 9
,
ÜÜ9 :
	runStatus
ÜÜ; D
)
ÜÜD E
;
ÜÜE F
using
àà 
(
àà 
var
àà 
reader
àà %
=
àà& '
cmd
àà( +
.
àà+ ,
ExecuteReader
àà, 9
(
àà9 :
)
àà: ;
)
àà; <
{
ââ 
while
ää 
(
ää 
reader
ää %
.
ää% &
Read
ää& *
(
ää* +
)
ää+ ,
)
ää, -
{
ãã 
output
åå "
.
åå" #
Add
åå# &
(
åå& '
new
åå' *
DataRunModel
åå+ 7
(
åå7 8
KeyIn
åå8 =
:
åå= >
reader
åå? E
[
ååE F
$str
ååF S
]
ååS T
.
ååT U
ToString
ååU ]
(
åå] ^
)
åå^ _
+
åå` a
$str
ååb i
+
ååj k
reader
åål r
[
åår s
$stråås É
]ååÉ Ñ
.ååÑ Ö
ToStringååÖ ç
(ååç é
)ååé è
,ååè ê
TextInååë ó
:ååó ò
readerååô ü
[ååü †
$stråå† ≠
]åå≠ Æ
.ååÆ Ø
ToStringååØ ∑
(åå∑ ∏
)åå∏ π
+åå∫ ª
$strååº √
+ååƒ ≈
readeråå∆ Ã
[ååÃ Õ
$strååÕ ›
]åå› ﬁ
.ååﬁ ﬂ
ToStringååﬂ Á
(ååÁ Ë
)ååË È
)ååÈ Í
)ååÍ Î
;ååÎ Ï
}
çç 
}
éé 
}
èè 
}
êê 
else
ëë 
{
íí 
Log
ìì 
.
ìì 
Debug
ìì 
(
ìì 
$str
ìì M
)
ììM N
;
ììN O
}
îî 
return
ïï 
output
ïï 
;
ïï 
}
ññ 	
public
òò 
static
òò 
IEnumerable
òò !
<
òò! "
WriteObject
òò" -
>
òò- .
GetResultsByRunid
òò/ @
(
òò@ A
string
òòA G
runid
òòH M
)
òòM N
{
ôô 	
foreach
öö 
(
öö 
var
öö 
cxn
öö 
in
öö 
Connections
öö  +
)
öö+ ,
{
õõ 
using
úú 
var
úú 
cmd
úú 
=
úú 
new
úú  #
SQLiteCommand
úú$ 1
(
úú1 2'
SQL_GET_RESULTS_BY_RUN_ID
úú2 K
,
úúK L
cxn
úúM P
.
úúP Q

Connection
úúQ [
,
úú[ \
cxn
úú] `
.
úú` a
Transaction
úúa l
)
úúl m
;
úúm n
cmd
ûû 
.
ûû 

Parameters
ûû 
.
ûû 
AddWithValue
ûû +
(
ûû+ ,
$str
ûû, 5
,
ûû5 6
runid
ûû7 <
)
ûû< =
;
ûû= >
using
üü 
(
üü 
var
üü 
reader
üü !
=
üü" #
cmd
üü$ '
.
üü' (
ExecuteReader
üü( 5
(
üü5 6
)
üü6 7
)
üü7 8
{
†† 
while
°° 
(
°° 
reader
°° !
.
°°! "
Read
°°" &
(
°°& '
)
°°' (
)
°°( )
{
¢¢ 
var
££ 
runId
££ !
=
££" #
reader
££$ *
[
££* +
$str
££+ 3
]
££3 4
.
££4 5
ToString
££5 =
(
££= >
)
££> ?
;
££? @
var
§§ 
resultTypeString
§§ ,
=
§§- .
reader
§§/ 5
[
§§5 6
$str
§§6 C
]
§§C D
.
§§D E
ToString
§§E M
(
§§M N
)
§§N O
;
§§O P
if
•• 
(
•• 
runId
•• !
!=
••" $
null
••% )
&&
••* ,
resultTypeString
••- =
!=
••> @
null
••A E
)
••E F
{
¶¶ 
var
ßß 
val
ßß  #
=
ßß$ %
WriteObject
ßß& 1
.
ßß1 2

FromString
ßß2 <
(
ßß< =
(
ßß= >
string
ßß> D
)
ßßD E
reader
ßßE K
[
ßßK L
$str
ßßL X
]
ßßX Y
,
ßßY Z
(
ßß[ \
RESULT_TYPE
ßß\ g
)
ßßg h
Enum
ßßh l
.
ßßl m
Parse
ßßm r
(
ßßr s
typeof
ßßs y
(
ßßy z
RESULT_TYPEßßz Ö
)ßßÖ Ü
,ßßÜ á 
resultTypeStringßßà ò
)ßßò ô
,ßßô ö
runIdßßõ †
)ßß† °
;ßß° ¢
if
®® 
(
®®  
val
®®  #
is
®®$ &
WriteObject
®®' 2
valid
®®3 8
)
®®8 9
yield
©©  %
return
©©& ,
valid
©©- 2
;
©©2 3
}
™™ 
}
´´ 
}
¨¨ 
}
≠≠ 
}
ÆÆ 	
public
∞∞ 
static
∞∞ 

Dictionary
∞∞  
<
∞∞  !
RESULT_TYPE
∞∞! ,
,
∞∞, -
int
∞∞. 1
>
∞∞1 2%
GetResultTypesAndCounts
∞∞3 J
(
∞∞J K
string
∞∞K Q
runId
∞∞R W
)
∞∞W X
{
±± 	
var
≤≤ 
outDict
≤≤ 
=
≤≤ 
new
≤≤ 

Dictionary
≤≤ (
<
≤≤( )
RESULT_TYPE
≤≤) 4
,
≤≤4 5
int
≤≤6 9
>
≤≤9 :
(
≤≤: ;
)
≤≤; <
{
≤≤= >
}
≤≤? @
;
≤≤@ A
try
≥≥ 
{
¥¥ 
if
µµ 
(
µµ 
MainConnection
µµ "
!=
µµ# %
null
µµ& *
)
µµ* +
{
∂∂ 
using
∑∑ 
(
∑∑ 
var
∑∑ 
cmd
∑∑ "
=
∑∑# $
new
∑∑% (
SQLiteCommand
∑∑) 6
(
∑∑6 7)
SQL_GET_RESULT_TYPES_COUNTS
∑∑7 R
,
∑∑R S
MainConnection
∑∑T b
.
∑∑b c

Connection
∑∑c m
,
∑∑m n
MainConnection
∑∑o }
.
∑∑} ~
Transaction∑∑~ â
)∑∑â ä
)∑∑ä ã
{
∏∏ 
cmd
ππ 
.
ππ 

Parameters
ππ &
.
ππ& '
AddWithValue
ππ' 3
(
ππ3 4
$str
ππ4 =
,
ππ= >
runId
ππ? D
)
ππD E
;
ππE F
using
ªª 
(
ªª 
var
ªª "
reader
ªª# )
=
ªª* +
cmd
ªª, /
.
ªª/ 0
ExecuteReader
ªª0 =
(
ªª= >
)
ªª> ?
)
ªª? @
{
ºº 
while
ΩΩ !
(
ΩΩ" #
reader
ΩΩ# )
.
ΩΩ) *
Read
ΩΩ* .
(
ΩΩ. /
)
ΩΩ/ 0
)
ΩΩ0 1
{
ææ 
if
øø  "
(
øø# $
Enum
øø$ (
.
øø( )
TryParse
øø) 1
(
øø1 2
reader
øø2 8
[
øø8 9
$str
øø9 F
]
øøF G
.
øøG H
ToString
øøH P
(
øøP Q
)
øøQ R
,
øøR S
out
øøT W
RESULT_TYPE
øøX c
result_type
øød o
)
øøo p
)
øøp q
{
¿¿  !
outDict
¡¡$ +
.
¡¡+ ,
TryAdd
¡¡, 2
(
¡¡2 3
result_type
¡¡3 >
,
¡¡> ?
int
¡¡@ C
.
¡¡C D
Parse
¡¡D I
(
¡¡I J
reader
¡¡J P
[
¡¡P Q
$str
¡¡Q X
]
¡¡X Y
.
¡¡Y Z
ToString
¡¡Z b
(
¡¡b c
)
¡¡c d
??
¡¡e g
$str
¡¡h l
,
¡¡l m
CultureInfo
¡¡n y
.
¡¡y z
InvariantCulture¡¡z ä
)¡¡ä ã
)¡¡ã å
;¡¡å ç
}
¬¬  !
}
√√ 
}
ƒƒ 
}
≈≈ 
}
∆∆ 
}
«« 
catch
»» 
(
»» 
SQLiteException
»» "
)
»»" #
{
…… 
Log
   
.
   
Error
   
(
   
Strings
   !
.
  ! "
Get
  " %
(
  % &
$str
  & =
)
  = >
)
  > ?
;
  ? @
}
ÀÀ 
return
ÃÃ 
outDict
ÃÃ 
;
ÃÃ 
}
ÕÕ 	
public
œœ 
static
œœ 
AsaRun
œœ 
?
œœ 
GetRun
œœ $
(
œœ$ %
string
œœ% +
RunId
œœ, 1
)
œœ1 2
{
–– 	
_
—— 
=
—— 
MainConnection
—— 
??
—— !
throw
——" '
new
——( +$
NullReferenceException
——, B
(
——B C
Strings
——C J
.
——J K
Get
——K N
(
——N O
$str
——O _
)
——_ `
)
——` a
;
——a b
using
”” 
(
”” 
var
”” 
cmd
”” 
=
”” 
new
””  
SQLiteCommand
””! .
(
””. /
SQL_GET_RUN
””/ :
,
””: ;
MainConnection
””< J
.
””J K

Connection
””K U
,
””U V
MainConnection
””W e
.
””e f
Transaction
””f q
)
””q r
)
””r s
{
‘‘ 
cmd
’’ 
.
’’ 

Parameters
’’ 
.
’’ 
AddWithValue
’’ +
(
’’+ ,
$str
’’, 5
,
’’5 6
RunId
’’7 <
)
’’< =
;
’’= >
using
÷÷ 
(
÷÷ 
var
÷÷ 
reader
÷÷ !
=
÷÷" #
cmd
÷÷$ '
.
÷÷' (
ExecuteReader
÷÷( 5
(
÷÷5 6
)
÷÷6 7
)
÷÷7 8
{
◊◊ 
while
ÿÿ 
(
ÿÿ 
reader
ÿÿ !
.
ÿÿ! "
Read
ÿÿ" &
(
ÿÿ& '
)
ÿÿ' (
)
ÿÿ( )
{
ŸŸ 
if
⁄⁄ 
(
⁄⁄ 
reader
⁄⁄ "
[
⁄⁄" #
$str
⁄⁄# /
]
⁄⁄/ 0
?
⁄⁄0 1
.
⁄⁄1 2
ToString
⁄⁄2 :
(
⁄⁄: ;
)
⁄⁄; <
is
⁄⁄= ?
string
⁄⁄@ F

serialized
⁄⁄G Q
)
⁄⁄Q R
{
€€ 
return
‹‹ "
JsonConvert
‹‹# .
.
‹‹. /
DeserializeObject
‹‹/ @
<
‹‹@ A
AsaRun
‹‹A G
>
‹‹G H
(
‹‹H I

serialized
‹‹I S
)
‹‹S T
;
‹‹T U
}
›› 
}
ﬁﬁ 
}
ﬂﬂ 
}
‡‡ 
return
·· 
null
·· 
;
·· 
}
‚‚ 	
public
‰‰ 
static
‰‰ 
List
‰‰ 
<
‰‰ 
string
‰‰ !
>
‰‰! "
GetRuns
‰‰# *
(
‰‰* +
string
‰‰+ 1
type
‰‰2 6
)
‰‰6 7
{
ÂÂ 	
_
ÊÊ 
=
ÊÊ 
MainConnection
ÊÊ 
??
ÊÊ !
throw
ÊÊ" '
new
ÊÊ( +$
NullReferenceException
ÊÊ, B
(
ÊÊB C
Strings
ÊÊC J
.
ÊÊJ K
Get
ÊÊK N
(
ÊÊN O
$str
ÊÊO _
)
ÊÊ_ `
)
ÊÊ` a
;
ÊÊa b
string
ËË 
Select_Runs
ËË 
=
ËË  
$str
ËË! l
;
ËËl m
List
ÍÍ 
<
ÍÍ 
string
ÍÍ 
>
ÍÍ 
Runs
ÍÍ 
=
ÍÍ 
new
ÍÍ  #
List
ÍÍ$ (
<
ÍÍ( )
string
ÍÍ) /
>
ÍÍ/ 0
(
ÍÍ0 1
)
ÍÍ1 2
;
ÍÍ2 3
using
ÏÏ 
var
ÏÏ 
cmd
ÏÏ 
=
ÏÏ 
new
ÏÏ 
SQLiteCommand
ÏÏ  -
(
ÏÏ- .
Select_Runs
ÏÏ. 9
,
ÏÏ9 :
MainConnection
ÏÏ; I
.
ÏÏI J

Connection
ÏÏJ T
,
ÏÏT U
MainConnection
ÏÏV d
.
ÏÏd e
Transaction
ÏÏe p
)
ÏÏp q
;
ÏÏq r
cmd
ÌÌ 
.
ÌÌ 

Parameters
ÌÌ 
.
ÌÌ 
AddWithValue
ÌÌ '
(
ÌÌ' (
$str
ÌÌ( /
,
ÌÌ/ 0
type
ÌÌ1 5
)
ÌÌ5 6
;
ÌÌ6 7
using
ÓÓ 
(
ÓÓ 
var
ÓÓ 
reader
ÓÓ 
=
ÓÓ 
cmd
ÓÓ  #
.
ÓÓ# $
ExecuteReader
ÓÓ$ 1
(
ÓÓ1 2
)
ÓÓ2 3
)
ÓÓ3 4
{
ÔÔ 
while
 
(
 
reader
 
.
 
Read
 "
(
" #
)
# $
)
$ %
{
ÒÒ 
Runs
ÚÚ 
.
ÚÚ 
Add
ÚÚ 
(
ÚÚ 
(
ÚÚ 
string
ÚÚ $
)
ÚÚ$ %
reader
ÚÚ% +
[
ÚÚ+ ,
$str
ÚÚ, 4
]
ÚÚ4 5
)
ÚÚ5 6
;
ÚÚ6 7
}
ÛÛ 
}
ÙÙ 
return
ıı 
Runs
ıı 
;
ıı 
}
ˆˆ 	
public
¯¯ 
static
¯¯ 
List
¯¯ 
<
¯¯ 
string
¯¯ !
>
¯¯! "
GetRuns
¯¯# *
(
¯¯* +
)
¯¯+ ,
{
˘˘ 	
return
˙˙ 
GetRuns
˙˙ 
(
˙˙ 
$str
˙˙ $
)
˙˙$ %
;
˙˙% &
}
˚˚ 	
public
˝˝ 
static
˝˝ 
List
˝˝ 
<
˝˝ 
FileMonitorEvent
˝˝ +
>
˝˝+ ,)
GetSerializedMonitorResults
˝˝- H
(
˝˝H I
string
˝˝I O
runId
˝˝P U
)
˝˝U V
{
˛˛ 	
List
ˇˇ 
<
ˇˇ 
FileMonitorEvent
ˇˇ !
>
ˇˇ! "
records
ˇˇ# *
=
ˇˇ+ ,
new
ˇˇ- 0
List
ˇˇ1 5
<
ˇˇ5 6
FileMonitorEvent
ˇˇ6 F
>
ˇˇF G
(
ˇˇG H
)
ˇˇH I
;
ˇˇI J
if
ÄÄ 
(
ÄÄ 
MainConnection
ÄÄ 
!=
ÄÄ !
null
ÄÄ" &
)
ÄÄ& '
{
ÅÅ 
using
ÇÇ 
(
ÇÇ 
var
ÇÇ 
cmd
ÇÇ 
=
ÇÇ  
new
ÇÇ! $
SQLiteCommand
ÇÇ% 2
(
ÇÇ2 3$
GET_SERIALIZED_RESULTS
ÇÇ3 I
,
ÇÇI J
MainConnection
ÇÇK Y
.
ÇÇY Z

Connection
ÇÇZ d
,
ÇÇd e
MainConnection
ÇÇf t
.
ÇÇt u
TransactionÇÇu Ä
)ÇÇÄ Å
)ÇÇÅ Ç
{
ÉÉ 
cmd
ÑÑ 
.
ÑÑ 

Parameters
ÑÑ "
.
ÑÑ" #
AddWithValue
ÑÑ# /
(
ÑÑ/ 0
$str
ÑÑ0 9
,
ÑÑ9 :
runId
ÑÑ; @
)
ÑÑ@ A
;
ÑÑA B
using
ÖÖ 
(
ÖÖ 
var
ÖÖ 
reader
ÖÖ %
=
ÖÖ& '
cmd
ÖÖ( +
.
ÖÖ+ ,
ExecuteReader
ÖÖ, 9
(
ÖÖ9 :
)
ÖÖ: ;
)
ÖÖ; <
{
ÜÜ 
FileMonitorEvent
áá (
obj
áá) ,
;
áá, -
while
ââ 
(
ââ 
reader
ââ %
.
ââ% &
Read
ââ& *
(
ââ* +
)
ââ+ ,
)
ââ, -
{
ää 
if
ãã 
(
ãã  
reader
ãã  &
[
ãã& '
$str
ãã' 3
]
ãã3 4
.
ãã4 5
ToString
ãã5 =
(
ãã= >
)
ãã> ?
is
ãã@ B
string
ããC I

serialized
ããJ T
)
ããT U
{
åå 
try
çç  #
{
éé  !
obj
èè$ '
=
èè( )
JsonConvert
èè* 5
.
èè5 6
DeserializeObject
èè6 G
<
èèG H
FileMonitorEvent
èèH X
>
èèX Y
(
èèY Z

serialized
èèZ d
)
èèd e
;
èèe f
obj
êê$ '
.
êê' (

ChangeType
êê( 2
=
êê3 4
(
êê5 6
CHANGE_TYPE
êê6 A
)
êêA B
int
êêB E
.
êêE F
Parse
êêF K
(
êêK L
reader
êêL R
[
êêR S
$str
êêS `
]
êê` a
.
êêa b
ToString
êêb j
(
êêj k
)
êêk l
??
êêm o
$str
êêp s
,
êês t
CultureInfoêêu Ä
.êêÄ Å 
InvariantCultureêêÅ ë
)êêë í
;êêí ì
records
ëë$ +
.
ëë+ ,
Add
ëë, /
(
ëë/ 0
obj
ëë0 3
)
ëë3 4
;
ëë4 5
}
íí  !
catch
ìì  %
(
ìì& '
	Exception
ìì' 0
e
ìì1 2
)
ìì2 3
{
îî  !
Log
ïï$ '
.
ïï' (
Debug
ïï( -
(
ïï- .
e
ïï. /
,
ïï/ 0
$str
ïï1 a
,
ïïa b

serialized
ïïc m
)
ïïm n
;
ïïn o
}
ññ  !
}
óó 
}
òò 
}
ôô 
}
öö 
}
õõ 
return
ùù 
records
ùù 
;
ùù 
}
ûû 	
public
†† 
static
†† 
bool
†† 
HasElements
†† &
(
††& '
)
††' (
{
°° 	
return
¢¢ 
Connections
¢¢ 
.
¢¢ 
Any
¢¢ "
(
¢¢" #
x
¢¢# $
=>
¢¢% '
!
¢¢( )
x
¢¢) *
.
¢¢* +

WriteQueue
¢¢+ 5
.
¢¢5 6
IsEmpty
¢¢6 =
)
¢¢= >
;
¢¢> ?
}
££ 	
public
•• 
static
•• 
void
•• 
InsertAnalyzed
•• )
(
••) *
CompareResult
••* 7
objIn
••8 =
)
••= >
{
¶¶ 	
if
ßß 
(
ßß 
objIn
ßß 
!=
ßß 
null
ßß 
&&
ßß  
MainConnection
ßß! /
!=
ßß0 2
null
ßß3 7
)
ßß7 8
{
®® 
using
©© 
(
©© 
var
©© 
cmd
©© 
=
©©  
new
©©! $
SQLiteCommand
©©% 2
(
©©2 3(
SQL_INSERT_FINDINGS_RESULT
©©3 M
,
©©M N
MainConnection
©©O ]
.
©©] ^

Connection
©©^ h
,
©©h i
MainConnection
©©j x
.
©©x y
Transaction©©y Ñ
)©©Ñ Ö
)©©Ö Ü
{
™™ 
cmd
´´ 
.
´´ 

Parameters
´´ "
.
´´" #
AddWithValue
´´# /
(
´´/ 0
$str
´´0 ?
,
´´? @
objIn
´´A F
.
´´F G
	BaseRunId
´´G P
)
´´P Q
;
´´Q R
cmd
¨¨ 
.
¨¨ 

Parameters
¨¨ "
.
¨¨" #
AddWithValue
¨¨# /
(
¨¨/ 0
$str
¨¨0 @
,
¨¨@ A
objIn
¨¨B G
.
¨¨G H
CompareRunId
¨¨H T
)
¨¨T U
;
¨¨U V
cmd
≠≠ 
.
≠≠ 

Parameters
≠≠ "
.
≠≠" #
AddWithValue
≠≠# /
(
≠≠/ 0
$str
≠≠0 >
,
≠≠> ?
objIn
≠≠@ E
.
≠≠E F

ResultType
≠≠F P
)
≠≠P Q
;
≠≠Q R
cmd
ÆÆ 
.
ÆÆ 

Parameters
ÆÆ "
.
ÆÆ" #
AddWithValue
ÆÆ# /
(
ÆÆ/ 0
$str
ÆÆ0 8
,
ÆÆ8 9
objIn
ÆÆ: ?
.
ÆÆ? @
Analysis
ÆÆ@ H
)
ÆÆH I
;
ÆÆI J
cmd
ØØ 
.
ØØ 

Parameters
ØØ "
.
ØØ" #
AddWithValue
ØØ# /
(
ØØ/ 0
$str
ØØ0 ;
,
ØØ; <
objIn
ØØ= B
.
ØØB C
Identity
ØØC K
)
ØØK L
;
ØØL M
cmd
∞∞ 
.
∞∞ 

Parameters
∞∞ "
.
∞∞" #
AddWithValue
∞∞# /
(
∞∞/ 0
$str
∞∞0 =
,
∞∞= >
JsonConvert
∞∞? J
.
∞∞J K
SerializeObject
∞∞K Z
(
∞∞Z [
objIn
∞∞[ `
)
∞∞` a
)
∞∞a b
;
∞∞b c
cmd
±± 
.
±± 
ExecuteNonQuery
±± '
(
±±' (
)
±±( )
;
±±) *
}
≤≤ 
}
≥≥ 
else
¥¥ 
{
µµ 
Log
∂∂ 
.
∂∂ 
Debug
∂∂ 
(
∂∂ 
$str
∂∂ T
)
∂∂T U
;
∂∂U V
}
∑∑ 
}
∏∏ 	
public
∫∫ 
static
∫∫ 
void
∫∫ 
InsertCompareRun
∫∫ +
(
∫∫+ ,
string
∫∫, 2

firstRunId
∫∫3 =
,
∫∫= >
string
∫∫? E
secondRunId
∫∫F Q
,
∫∫Q R

RUN_STATUS
∫∫S ]
	runStatus
∫∫^ g
)
∫∫g h
{
ªª 	
_
ºº 
=
ºº 
MainConnection
ºº 
??
ºº !
throw
ºº" '
new
ºº( +$
NullReferenceException
ºº, B
(
ººB C
Strings
ººC J
.
ººJ K
Get
ººK N
(
ººN O
$str
ººO _
)
ºº_ `
)
ºº` a
;
ººa b
using
ΩΩ 
(
ΩΩ 
var
ΩΩ 
cmd
ΩΩ 
=
ΩΩ 
new
ΩΩ  
SQLiteCommand
ΩΩ! .
(
ΩΩ. /.
 INSERT_RUN_INTO_RESULT_TABLE_SQL
ΩΩ/ O
,
ΩΩO P
MainConnection
ΩΩQ _
.
ΩΩ_ `

Connection
ΩΩ` j
,
ΩΩj k
MainConnection
ΩΩl z
.
ΩΩz {
TransactionΩΩ{ Ü
)ΩΩÜ á
)ΩΩá à
{
ææ 
cmd
øø 
.
øø 

Parameters
øø 
.
øø 
AddWithValue
øø +
(
øø+ ,
$str
øø, :
,
øø: ;

firstRunId
øø< F
)
øøF G
;
øøG H
cmd
¿¿ 
.
¿¿ 

Parameters
¿¿ 
.
¿¿ 
AddWithValue
¿¿ +
(
¿¿+ ,
$str
¿¿, =
,
¿¿= >
secondRunId
¿¿? J
)
¿¿J K
;
¿¿K L
cmd
¡¡ 
.
¡¡ 

Parameters
¡¡ 
.
¡¡ 
AddWithValue
¡¡ +
(
¡¡+ ,
$str
¡¡, 5
,
¡¡5 6
	runStatus
¡¡7 @
)
¡¡@ A
;
¡¡A B
cmd
¬¬ 
.
¬¬ 
ExecuteNonQuery
¬¬ #
(
¬¬# $
)
¬¬$ %
;
¬¬% &
}
√√ 
}
ƒƒ 	
public
∆∆ 
static
∆∆ 
void
∆∆ 
	InsertRun
∆∆ $
(
∆∆$ %
AsaRun
∆∆% +
run
∆∆, /
)
∆∆/ 0
{
«« 	
if
»» 
(
»» 
run
»» 
==
»» 
null
»» 
)
»» 
{
…… 
return
   
;
   
}
ÀÀ 
if
ÃÃ 
(
ÃÃ 
MainConnection
ÃÃ 
!=
ÃÃ !
null
ÃÃ" &
)
ÃÃ& '
{
ÕÕ 
using
ŒŒ 
var
ŒŒ 
cmd
ŒŒ 
=
ŒŒ 
new
ŒŒ  #
SQLiteCommand
ŒŒ$ 1
(
ŒŒ1 2
SQL_INSERT_RUN
ŒŒ2 @
,
ŒŒ@ A
MainConnection
ŒŒB P
.
ŒŒP Q

Connection
ŒŒQ [
,
ŒŒ[ \
MainConnection
ŒŒ] k
.
ŒŒk l
Transaction
ŒŒl w
)
ŒŒw x
;
ŒŒx y
cmd
œœ 
.
œœ 

Parameters
œœ 
.
œœ 
AddWithValue
œœ +
(
œœ+ ,
$str
œœ, 5
,
œœ5 6
run
œœ7 :
.
œœ: ;
RunId
œœ; @
)
œœ@ A
;
œœA B
cmd
–– 
.
–– 

Parameters
–– 
.
–– 
AddWithValue
–– +
(
––+ ,
$str
––, 3
,
––3 4
run
––5 8
.
––8 9
Type
––9 =
)
––= >
;
––> ?
cmd
—— 
.
—— 

Parameters
—— 
.
—— 
AddWithValue
—— +
(
——+ ,
$str
——, 9
,
——9 :
JsonConvert
——; F
.
——F G
SerializeObject
——G V
(
——V W
run
——W Z
)
——Z [
)
——[ \
;
——\ ]
try
”” 
{
‘‘ 
cmd
’’ 
.
’’ 
ExecuteNonQuery
’’ '
(
’’' (
)
’’( )
;
’’) *
}
÷÷ 
catch
◊◊ 
(
◊◊ 
SQLiteException
◊◊ &
e
◊◊' (
)
◊◊( )
{
ÿÿ 
Log
ŸŸ 
.
ŸŸ 
Warning
ŸŸ 
(
ŸŸ  
e
ŸŸ  !
.
ŸŸ! "

StackTrace
ŸŸ" ,
)
ŸŸ, -
;
ŸŸ- .
Log
⁄⁄ 
.
⁄⁄ 
Warning
⁄⁄ 
(
⁄⁄  
e
⁄⁄  !
.
⁄⁄! "
Message
⁄⁄" )
)
⁄⁄) *
;
⁄⁄* +
}
€€ 
}
‹‹ 
else
›› 
{
ﬁﬁ 
Log
ﬂﬂ 
.
ﬂﬂ 
Debug
ﬂﬂ 
(
ﬂﬂ 
$str
ﬂﬂ O
)
ﬂﬂO P
;
ﬂﬂP Q
}
‡‡ 
}
·· 	
public
„„ 
static
„„ 
int
„„ 
ModuloString
„„ &
(
„„& '
string
„„' -
identity
„„. 6
,
„„6 7
int
„„8 ;
shardingFactor
„„< J
)
„„J K
=>
„„L N
identity
„„O W
.
„„W X
Sum
„„X [
(
„„[ \
x
„„\ ]
=>
„„^ `
x
„„a b
)
„„b c
%
„„d e
shardingFactor
„„f t
;
„„t u
public
ÂÂ 
static
ÂÂ 
int
ÂÂ !
PopulateConnections
ÂÂ -
(
ÂÂ- .
)
ÂÂ. /
{
ÊÊ 	
var
ÁÁ  
connectionsCreated
ÁÁ "
=
ÁÁ# $
$num
ÁÁ% &
;
ÁÁ& '
for
ËË 
(
ËË 
int
ËË 
i
ËË 
=
ËË 
Connections
ËË $
.
ËË$ %
Count
ËË% *
;
ËË* +
i
ËË, -
<
ËË. /

dbSettings
ËË0 :
.
ËË: ;
ShardingFactor
ËË; I
;
ËËI J
i
ËËK L
++
ËËL N
)
ËËN O
{
ÈÈ 
Connections
ÍÍ 
.
ÍÍ 
Add
ÍÍ 
(
ÍÍ  #
GenerateSqlConnection
ÍÍ  5
(
ÍÍ5 6
i
ÍÍ6 7
)
ÍÍ7 8
)
ÍÍ8 9
;
ÍÍ9 : 
connectionsCreated
ÎÎ "
++
ÎÎ" $
;
ÎÎ$ %
}
ÏÏ 
return
ÌÌ  
connectionsCreated
ÌÌ %
;
ÌÌ% &
}
ÓÓ 	
public
 
static
 
void
 
RollBack
 #
(
# $
)
$ %
{
ÒÒ 	
if
ÚÚ 
(
ÚÚ 
Connections
ÚÚ 
!=
ÚÚ 
null
ÚÚ #
)
ÚÚ# $
{
ÛÛ 
Connections
ÙÙ 
.
ÙÙ 

AsParallel
ÙÙ &
(
ÙÙ& '
)
ÙÙ' (
.
ÙÙ( )
ForAll
ÙÙ) /
(
ÙÙ/ 0
cxn
ÙÙ0 3
=>
ÙÙ4 6
{
ıı 
try
ˆˆ 
{
˜˜ 
cxn
¯¯ 
.
¯¯ 
Transaction
¯¯ '
?
¯¯' (
.
¯¯( )
Rollback
¯¯) 1
(
¯¯1 2
)
¯¯2 3
;
¯¯3 4
}
˘˘ 
catch
˙˙ 
(
˙˙ $
NullReferenceException
˙˙ 1
)
˙˙1 2
{
˚˚ 
}
˚˚ 
finally
¸¸ 
{
˝˝ 
cxn
˛˛ 
.
˛˛ 
Transaction
˛˛ '
=
˛˛( )
null
˛˛* .
;
˛˛. /
}
ˇˇ 
}
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 
}
ÇÇ 	
public
ÑÑ 
static
ÑÑ 
PLATFORM
ÑÑ 
RunIdToPlatform
ÑÑ .
(
ÑÑ. /
string
ÑÑ/ 5
runid
ÑÑ6 ;
)
ÑÑ; <
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 
MainConnection
ÜÜ 
!=
ÜÜ !
null
ÜÜ" &
)
ÜÜ& '
{
áá 
using
àà 
(
àà 
var
àà 
cmd
àà 
=
àà  
new
àà! $
SQLiteCommand
àà% 2
(
àà2 3)
SQL_GET_PLATFORM_FROM_RUNID
àà3 N
,
ààN O
MainConnection
ààP ^
.
àà^ _

Connection
àà_ i
,
àài j
MainConnection
ààk y
.
àày z
Transactionààz Ö
)ààÖ Ü
)ààÜ á
{
ââ 
cmd
ää 
.
ää 

Parameters
ää "
.
ää" #
AddWithValue
ää# /
(
ää/ 0
$str
ää0 9
,
ää9 :
runid
ää; @
)
ää@ A
;
ääA B
using
ãã 
(
ãã 
var
ãã 
reader
ãã %
=
ãã& '
cmd
ãã( +
.
ãã+ ,
ExecuteReader
ãã, 9
(
ãã9 :
)
ãã: ;
)
ãã; <
{
åå 
reader
çç 
.
çç 
Read
çç #
(
çç# $
)
çç$ %
;
çç% &
var
éé 
platform
éé $
=
éé% &
reader
éé' -
[
éé- .
$str
éé. 8
]
éé8 9
.
éé9 :
ToString
éé: B
(
ééB C
)
ééC D
;
ééD E
if
èè 
(
èè 
platform
èè $
!=
èè% '
null
èè( ,
)
èè, -
{
êê 
return
ëë "
(
ëë# $
PLATFORM
ëë$ ,
)
ëë, -
Enum
ëë- 1
.
ëë1 2
Parse
ëë2 7
(
ëë7 8
typeof
ëë8 >
(
ëë> ?
PLATFORM
ëë? G
)
ëëG H
,
ëëH I
platform
ëëJ R
)
ëëR S
;
ëëS T
}
íí 
}
ìì 
}
îî 
}
ïï 
else
ññ 
{
óó 
Log
òò 
.
òò 
Debug
òò 
(
òò 
$str
òò S
)
òòS T
;
òòT U
}
ôô 
return
öö 
PLATFORM
öö 
.
öö 
UNKNOWN
öö #
;
öö# $
}
õõ 	
public
ùù 
static
ùù 
bool
ùù 
Setup
ùù  
(
ùù  !
string
ùù! '
filename
ùù( 0
,
ùù0 1

DBSettings
ùù2 <
?
ùù< =
dbSettingsIn
ùù> J
=
ùùK L
null
ùùM Q
)
ùùQ R
{
ûû 	

dbSettings
üü 
=
üü 
(
üü 
dbSettingsIn
üü &
==
üü' )
null
üü* .
)
üü. /
?
üü0 1
new
üü2 5

DBSettings
üü6 @
(
üü@ A
)
üüA B
:
üüC D
dbSettingsIn
üüE Q
;
üüQ R
if
°° 
(
°° 
filename
°° 
!=
°° 
null
°°  
)
°°  !
{
¢¢ 
if
££ 
(
££ 
SQLiteFilename
££ "
!=
££# %
filename
££& .
)
££. /
{
§§ 
SQLiteFilename
•• "
=
••# $
filename
••% -
;
••- .
}
¶¶ 
}
ßß 
if
©© 
(
©© 
Connections
©© 
.
©© 
Count
©© !
>
©©" #
$num
©©$ %
)
©©% &
{
™™ 
CloseDatabase
´´ 
(
´´ 
)
´´ 
;
´´  
}
¨¨ 
if
ÆÆ 
(
ÆÆ 
Connections
ÆÆ 
==
ÆÆ 
null
ÆÆ #
||
ÆÆ$ &
Connections
ÆÆ' 2
.
ÆÆ2 3
Count
ÆÆ3 8
==
ÆÆ9 ;
$num
ÆÆ< =
)
ÆÆ= >
{
ØØ 
Connections
∞∞ 
=
∞∞ 
new
∞∞ !
List
∞∞" &
<
∞∞& '-
SystemSQLiteSqlConnectionHolder
∞∞' F
>
∞∞F G
(
∞∞G H
)
∞∞H I
;
∞∞I J!
PopulateConnections
≤≤ #
(
≤≤# $
)
≤≤$ %
;
≤≤% &
var
¥¥ 
settings
¥¥ 
=
¥¥ 
GetSettings
¥¥ *
(
¥¥* +
)
¥¥+ ,
;
¥¥, -
if
µµ 
(
µµ 
settings
µµ 
!=
µµ 
null
µµ  $
)
µµ$ %
{
∂∂ 
FirstRun
∑∑ 
=
∑∑ 
false
∑∑ $
;
∑∑$ %
if
ππ 
(
ππ 
SCHEMA_VERSION
ππ &
!=
ππ' )
settings
ππ* 2
.
ππ2 3
SchemaVersion
ππ3 @
)
ππ@ A
{
∫∫ 
Log
ªª 
.
ªª 
Fatal
ªª !
(
ªª! "
$strªª" ä
)ªªä ã
;ªªã å
Environment
ºº #
.
ºº# $
Exit
ºº$ (
(
ºº( )
(
ºº) *
int
ºº* -
)
ºº- .
	ASA_ERROR
ºº. 7
.
ºº7 8
MATCHING_SCHEMA
ºº8 G
)
ººG H
;
ººH I
}
ΩΩ 
if
øø 
(
øø 
dbSettingsIn
øø $
!=
øø% '
null
øø( ,
&&
øø- /
settings
øø0 8
.
øø8 9
ShardingFactor
øø9 G
!=
øøH J
dbSettingsIn
øøK W
.
øøW X
ShardingFactor
øøX f
)
øøf g
{
¿¿ 
Log
¡¡ 
.
¡¡ 
Information
¡¡ '
(
¡¡' (
$"
¡¡( *
$str
¡¡* F
{
¡¡F G
dbSettingsIn
¡¡G S
.
¡¡S T
ShardingFactor
¡¡T b
}
¡¡b c
$str¡¡c Ç
{¡¡Ç É
settings¡¡É ã
.¡¡ã å
ShardingFactor¡¡å ö
}¡¡ö õ
$str¡¡õ ∏
{¡¡∏ π
settings¡¡π ¡
.¡¡¡ ¬
ShardingFactor¡¡¬ –
}¡¡– —
$str¡¡— “
"¡¡“ ”
)¡¡” ‘
;¡¡‘ ’
}
¬¬ 

dbSettings
ƒƒ 
.
ƒƒ 
ShardingFactor
ƒƒ -
=
ƒƒ. /
settings
ƒƒ0 8
.
ƒƒ8 9
ShardingFactor
ƒƒ9 G
;
ƒƒG H
}
≈≈ 
else
∆∆ 
{
«« 
FirstRun
»» 
=
»» 
true
»» #
;
»»# $
}
…… !
PopulateConnections
ÀÀ #
(
ÀÀ# $
)
ÀÀ$ %
;
ÀÀ% &
if
ÕÕ 
(
ÕÕ 
MainConnection
ÕÕ "
==
ÕÕ# %
null
ÕÕ& *
)
ÕÕ* +
{
ŒŒ 
Log
œœ 
.
œœ 
Warning
œœ 
(
œœ  
$str
œœ  d
)
œœd e
;
œœe f
return
–– 
false
––  
;
––  !
}
—— 
if
”” 
(
”” 
FirstRun
”” 
)
”” 
{
‘‘ 
try
’’ 
{
÷÷ 
BeginTransaction
◊◊ (
(
◊◊( )
)
◊◊) *
;
◊◊* +
using
ŸŸ 
var
ŸŸ !
cmd2
ŸŸ" &
=
ŸŸ' (
new
ŸŸ) ,
SQLiteCommand
ŸŸ- :
(
ŸŸ: ;
SQL_CREATE_RUNS
ŸŸ; J
,
ŸŸJ K
MainConnection
ŸŸL Z
.
ŸŸZ [

Connection
ŸŸ[ e
,
ŸŸe f
MainConnection
ŸŸg u
.
ŸŸu v
TransactionŸŸv Å
)ŸŸÅ Ç
;ŸŸÇ É
cmd2
⁄⁄ 
.
⁄⁄ 
ExecuteNonQuery
⁄⁄ ,
(
⁄⁄, -
)
⁄⁄- .
;
⁄⁄. /
cmd2
‹‹ 
.
‹‹ 
CommandText
‹‹ (
=
‹‹) * 
SQL_CREATE_RESULTS
‹‹+ =
;
‹‹= >
cmd2
›› 
.
›› 
ExecuteNonQuery
›› ,
(
››, -
)
››- .
;
››. /
cmd2
ﬂﬂ 
.
ﬂﬂ 
CommandText
ﬂﬂ (
=
ﬂﬂ) *)
SQL_CREATE_FINDINGS_RESULTS
ﬂﬂ+ F
;
ﬂﬂF G
cmd2
‡‡ 
.
‡‡ 
ExecuteNonQuery
‡‡ ,
(
‡‡, -
)
‡‡- .
;
‡‡. /
cmd2
‚‚ 
.
‚‚ 
CommandText
‚‚ (
=
‚‚) *-
SQL_CREATE_FINDINGS_LEVEL_INDEX
‚‚+ J
;
‚‚J K
cmd2
„„ 
.
„„ 
ExecuteNonQuery
„„ ,
(
„„, -
)
„„- .
;
„„. /
cmd2
ÂÂ 
.
ÂÂ 
CommandText
ÂÂ (
=
ÂÂ) *3
%SQL_CREATE_FINDINGS_RESULT_TYPE_INDEX
ÂÂ+ P
;
ÂÂP Q
cmd2
ÊÊ 
.
ÊÊ 
ExecuteNonQuery
ÊÊ ,
(
ÊÊ, -
)
ÊÊ- .
;
ÊÊ. /
cmd2
ËË 
.
ËË 
CommandText
ËË (
=
ËË) *0
"SQL_CREATE_FINDINGS_IDENTITY_INDEX
ËË+ M
;
ËËM N
cmd2
ÈÈ 
.
ÈÈ 
ExecuteNonQuery
ÈÈ ,
(
ÈÈ, -
)
ÈÈ- .
;
ÈÈ. /
cmd2
ÎÎ 
.
ÎÎ 
CommandText
ÎÎ (
=
ÎÎ) *9
+SQL_CREATE_FINDINGS_LEVEL_RESULT_TYPE_INDEX
ÎÎ+ V
;
ÎÎV W
cmd2
ÏÏ 
.
ÏÏ 
ExecuteNonQuery
ÏÏ ,
(
ÏÏ, -
)
ÏÏ- .
;
ÏÏ. /
cmd2
ÓÓ 
.
ÓÓ 
CommandText
ÓÓ (
=
ÓÓ) *'
SQL_CREATE_FILE_MONITORED
ÓÓ+ D
;
ÓÓD E
cmd2
ÔÔ 
.
ÔÔ 
ExecuteNonQuery
ÔÔ ,
(
ÔÔ, -
)
ÔÔ- .
;
ÔÔ. /
cmd2
ÒÒ 
.
ÒÒ 
CommandText
ÒÒ (
=
ÒÒ) *+
SQL_CREATE_PERSISTED_SETTINGS
ÒÒ+ H
;
ÒÒH I
cmd2
ÚÚ 
.
ÚÚ 
ExecuteNonQuery
ÚÚ ,
(
ÚÚ, -
)
ÚÚ- .
;
ÚÚ. /
SetSettings
ÙÙ #
(
ÙÙ# $
new
ÙÙ$ '
Settings
ÙÙ( 0
(
ÙÙ0 1
)
ÙÙ1 2
{
ıı 
SchemaVersion
ˆˆ )
=
ˆˆ* +
SCHEMA_VERSION
ˆˆ, :
,
ˆˆ: ;
ShardingFactor
˜˜ *
=
˜˜+ ,

dbSettings
˜˜- 7
.
˜˜7 8
ShardingFactor
˜˜8 F
,
˜˜F G
}
¯¯ 
)
¯¯ 
;
¯¯ 
Connections
˙˙ #
.
˙˙# $

AsParallel
˙˙$ .
(
˙˙. /
)
˙˙/ 0
.
˙˙0 1
ForAll
˙˙1 7
(
˙˙7 8
cxn
˙˙8 ;
=>
˙˙< >
{
˚˚ 
using
¸¸ !
(
¸¸" #
var
¸¸# &
innerCmd
¸¸' /
=
¸¸0 1
new
¸¸2 5
SQLiteCommand
¸¸6 C
(
¸¸C D(
SQL_CREATE_COLLECT_RESULTS
¸¸D ^
,
¸¸^ _
cxn
¸¸` c
.
¸¸c d

Connection
¸¸d n
,
¸¸n o
cxn
¸¸p s
.
¸¸s t
Transaction
¸¸t 
)¸¸ Ä
)¸¸Ä Å
{
˝˝ 
innerCmd
˛˛  (
.
˛˛( )
ExecuteNonQuery
˛˛) 8
(
˛˛8 9
)
˛˛9 :
;
˛˛: ;
innerCmd
ÄÄ  (
.
ÄÄ( )
CommandText
ÄÄ) 4
=
ÄÄ5 6-
SQL_CREATE_COLLECT_RUN_ID_INDEX
ÄÄ7 V
;
ÄÄV W
innerCmd
ÅÅ  (
.
ÅÅ( )
ExecuteNonQuery
ÅÅ) 8
(
ÅÅ8 9
)
ÅÅ9 :
;
ÅÅ: ;
innerCmd
ÉÉ  (
.
ÉÉ( )
CommandText
ÉÉ) 4
=
ÉÉ5 6@
2SQL_CREATE_COLLECT_RUN_KEY_IDENTITY_COMBINED_INDEX
ÉÉ7 i
;
ÉÉi j
innerCmd
ÑÑ  (
.
ÑÑ( )
ExecuteNonQuery
ÑÑ) 8
(
ÑÑ8 9
)
ÑÑ9 :
;
ÑÑ: ;
innerCmd
ÜÜ  (
.
ÜÜ( )
CommandText
ÜÜ) 4
=
ÜÜ5 66
(SQL_CREATE_COLLECT_RUN_ID_IDENTITY_INDEX
ÜÜ7 _
;
ÜÜ_ `
innerCmd
áá  (
.
áá( )
ExecuteNonQuery
áá) 8
(
áá8 9
)
áá9 :
;
áá: ;
}
àà 
}
ââ 
)
ââ 
;
ââ 
}
ää 
catch
ãã 
(
ãã 
SQLiteException
ãã *
e
ãã+ ,
)
ãã, -
{
åå 
Log
çç 
.
çç 
Debug
çç !
(
çç! "
e
çç" #
,
çç# $
$str
çç% G
)
ççG H
;
ççH I
Environment
éé #
.
éé# $
Exit
éé$ (
(
éé( )
(
éé) *
int
éé* -
)
éé- .
	ASA_ERROR
éé. 7
.
éé7 8'
FAILED_TO_CREATE_DATABASE
éé8 Q
)
ééQ R
;
ééR S
}
èè 
finally
êê 
{
ëë 
Commit
íí 
(
íí 
)
íí  
;
íí  !
}
ìì 
}
îî 
return
ññ 
true
ññ 
;
ññ 
}
óó 
return
òò 
false
òò 
;
òò 
}
ôô 	
public
õõ 
static
õõ 
void
õõ 
TrimToLatest
õõ '
(
õõ' (
)
õõ( )
{
úú 	
if
ùù 
(
ùù 
MainConnection
ùù 
!=
ùù !
null
ùù" &
)
ùù& '
{
ûû 
List
üü 
<
üü 
string
üü 
>
üü 
Runs
üü !
=
üü" #
new
üü$ '
List
üü( ,
<
üü, -
string
üü- 3
>
üü3 4
(
üü4 5
)
üü5 6
;
üü6 7
using
†† 
var
†† 
cmd
†† 
=
†† 
new
††  #
SQLiteCommand
††$ 1
(
††1 2
GET_RUNS
††2 :
,
††: ;
MainConnection
††< J
.
††J K

Connection
††K U
,
††U V
MainConnection
††W e
.
††e f
Transaction
††f q
)
††q r
;
††r s
using
°° 
(
°° 
var
°° 
reader
°° !
=
°°" #
cmd
°°$ '
.
°°' (
ExecuteReader
°°( 5
(
°°5 6
)
°°6 7
)
°°7 8
{
¢¢ 
reader
§§ 
.
§§ 
Read
§§ 
(
§§  
)
§§  !
;
§§! "
while
¶¶ 
(
¶¶ 
reader
¶¶ !
.
¶¶! "
Read
¶¶" &
(
¶¶& '
)
¶¶' (
)
¶¶( )
{
ßß 
	DeleteRun
®® !
(
®®! "
(
®®" #
string
®®# )
)
®®) *
reader
®®* 0
[
®®0 1
$str
®®1 9
]
®®9 :
)
®®: ;
;
®®; <
}
©© 
}
™™ 
}
´´ 
else
¨¨ 
{
≠≠ 
Log
ÆÆ 
.
ÆÆ 
Debug
ÆÆ 
(
ÆÆ 
$str
ÆÆ C
)
ÆÆC D
;
ÆÆD E
}
ØØ 
}
∞∞ 	
public
≤≤ 
static
≤≤ 
void
≤≤ 
UpdateCompareRun
≤≤ +
(
≤≤+ ,
string
≤≤, 2

firstRunId
≤≤3 =
,
≤≤= >
string
≤≤? E
secondRunId
≤≤F Q
,
≤≤Q R

RUN_STATUS
≤≤S ]
	runStatus
≤≤^ g
)
≤≤g h
{
≥≥ 	
_
¥¥ 
=
¥¥ 
MainConnection
¥¥ 
??
¥¥ !
throw
¥¥" '
new
¥¥( +$
NullReferenceException
¥¥, B
(
¥¥B C
Strings
¥¥C J
.
¥¥J K
Get
¥¥K N
(
¥¥N O
$str
¥¥O _
)
¥¥_ `
)
¥¥` a
;
¥¥a b
using
µµ 
(
µµ 
var
µµ 
cmd
µµ 
=
µµ 
new
µµ  
SQLiteCommand
µµ! .
(
µµ. /(
UPDATE_RUN_IN_RESULT_TABLE
µµ/ I
,
µµI J
MainConnection
µµK Y
.
µµY Z

Connection
µµZ d
,
µµd e
MainConnection
µµf t
.
µµt u
Transactionµµu Ä
)µµÄ Å
)µµÅ Ç
{
∂∂ 
cmd
∑∑ 
.
∑∑ 

Parameters
∑∑ 
.
∑∑ 
AddWithValue
∑∑ +
(
∑∑+ ,
$str
∑∑, :
,
∑∑: ;

firstRunId
∑∑< F
)
∑∑F G
;
∑∑G H
cmd
∏∏ 
.
∏∏ 

Parameters
∏∏ 
.
∏∏ 
AddWithValue
∏∏ +
(
∏∏+ ,
$str
∏∏, =
,
∏∏= >
secondRunId
∏∏? J
)
∏∏J K
;
∏∏K L
cmd
ππ 
.
ππ 

Parameters
ππ 
.
ππ 
AddWithValue
ππ +
(
ππ+ ,
$str
ππ, 5
,
ππ5 6
	runStatus
ππ7 @
)
ππ@ A
;
ππA B
cmd
∫∫ 
.
∫∫ 
ExecuteNonQuery
∫∫ #
(
∫∫# $
)
∫∫$ %
;
∫∫% &
}
ªª 
}
ºº 	
public
ææ 
static
ææ 
void
ææ 
Vacuum
ææ !
(
ææ! "
)
ææ" #
{
øø 	
Connections
¿¿ 
.
¿¿ 

AsParallel
¿¿ "
(
¿¿" #
)
¿¿# $
.
¿¿$ %
ForAll
¿¿% +
(
¿¿+ ,
cxn
¿¿, /
=>
¿¿0 2
{
¡¡ 
using
¬¬ 
var
¬¬ 
	inner_cmd
¬¬ #
=
¬¬$ %
new
¬¬& )
SQLiteCommand
¬¬* 7
(
¬¬7 8

SQL_VACUUM
¬¬8 B
,
¬¬B C
cxn
¬¬D G
.
¬¬G H

Connection
¬¬H R
,
¬¬R S
cxn
¬¬T W
.
¬¬W X
Transaction
¬¬X c
)
¬¬c d
;
¬¬d e
	inner_cmd
√√ 
.
√√ 
ExecuteNonQuery
√√ )
(
√√) *
)
√√* +
;
√√+ ,
}
ƒƒ 
)
ƒƒ 
;
ƒƒ 
}
≈≈ 	
public
«« 
static
«« 
void
«« 
Write
««  
(
««  !
CollectObject
««! .
?
««. /
colObj
««0 6
,
««6 7
string
««8 >
?
««> ?
runId
««@ E
)
««E F
{
»» 	
if
…… 
(
…… 
colObj
…… 
!=
…… 
null
…… 
&&
…… !
runId
……" '
!=
……( *
null
……+ /
)
……/ 0
{
   
var
ÀÀ 
objIn
ÀÀ 
=
ÀÀ 
new
ÀÀ 
WriteObject
ÀÀ  +
(
ÀÀ+ ,
colObj
ÀÀ, 2
,
ÀÀ2 3
runId
ÀÀ4 9
)
ÀÀ9 :
;
ÀÀ: ;
Connections
ÃÃ 
[
ÃÃ 
ModuloString
ÃÃ (
(
ÃÃ( )
objIn
ÃÃ) .
.
ÃÃ. /
Identity
ÃÃ/ 7
,
ÃÃ7 8
shardingFactor
ÃÃ9 G
:
ÃÃG H

dbSettings
ÃÃI S
.
ÃÃS T
ShardingFactor
ÃÃT b
)
ÃÃb c
]
ÃÃc d
.
ÃÃd e

WriteQueue
ÃÃe o
.
ÃÃo p
Enqueue
ÃÃp w
(
ÃÃw x
objIn
ÃÃx }
)
ÃÃ} ~
;
ÃÃ~ 
}
ÕÕ 
}
ŒŒ 	
public
–– 
static
–– 
void
–– 
WriteFileMonitor
–– +
(
––+ ,
FileMonitorObject
––, =
fmo
––> A
,
––A B
string
––C I
RunId
––J O
)
––O P
{
—— 	
if
““ 
(
““ 
fmo
““ 
==
““ 
null
““ 
)
““ 
{
”” 
return
‘‘ 
;
‘‘ 
}
’’ 
_
÷÷ 
=
÷÷ 
MainConnection
÷÷ 
??
÷÷ !
throw
÷÷" '
new
÷÷( +$
NullReferenceException
÷÷, B
(
÷÷B C
Strings
÷÷C J
.
÷÷J K
Get
÷÷K N
(
÷÷N O
$str
÷÷O _
)
÷÷_ `
)
÷÷` a
;
÷÷a b
using
◊◊ 
var
◊◊ 
cmd
◊◊ 
=
◊◊ 
new
◊◊ 
SQLiteCommand
◊◊  -
(
◊◊- .

SQL_INSERT
◊◊. 8
,
◊◊8 9
MainConnection
◊◊: H
.
◊◊H I

Connection
◊◊I S
,
◊◊S T
MainConnection
◊◊U c
.
◊◊c d
Transaction
◊◊d o
)
◊◊o p
;
◊◊p q
cmd
ÿÿ 
.
ÿÿ 

Parameters
ÿÿ 
.
ÿÿ 
AddWithValue
ÿÿ '
(
ÿÿ' (
$str
ÿÿ( 1
,
ÿÿ1 2
RunId
ÿÿ3 8
)
ÿÿ8 9
;
ÿÿ9 :
cmd
ŸŸ 
.
ŸŸ 

Parameters
ŸŸ 
.
ŸŸ 
AddWithValue
ŸŸ '
(
ŸŸ' (
$str
ŸŸ( /
,
ŸŸ/ 0
fmo
ŸŸ1 4
.
ŸŸ4 5
Path
ŸŸ5 9
)
ŸŸ9 :
;
ŸŸ: ;
cmd
⁄⁄ 
.
⁄⁄ 

Parameters
⁄⁄ 
.
⁄⁄ 
AddWithValue
⁄⁄ '
(
⁄⁄' (
$str
⁄⁄( 4
,
⁄⁄4 5
fmo
⁄⁄6 9
.
⁄⁄9 :
	Timestamp
⁄⁄: C
)
⁄⁄C D
;
⁄⁄D E
cmd
€€ 
.
€€ 

Parameters
€€ 
.
€€ 
AddWithValue
€€ '
(
€€' (
$str
€€( 5
,
€€5 6
JsonConvert
€€7 B
.
€€B C
SerializeObject
€€C R
(
€€R S
fmo
€€S V
)
€€V W
)
€€W X
;
€€X Y
cmd
›› 
.
›› 
ExecuteNonQuery
›› 
(
››  
)
››  !
;
››! "
}
ﬁﬁ 	
private
‡‡ 
const
‡‡ 
string
‡‡ $
GET_COMPARISON_RESULTS
‡‡ 3
=
‡‡4 5
$str‡‡6 §
;‡‡§ •
private
·· 
const
·· 
string
·· *
GET_COMPARISON_RESULTS_LIMIT
·· 9
=
··: ;
$str··< æ
;··æ ø
private
‚‚ 
const
‚‚ 
string
‚‚ !
GET_MONITOR_RESULTS
‚‚ 0
=
‚‚1 2
$str‚‚3 ñ
;‚‚ñ ó
private
ÂÂ 
const
ÂÂ 
string
ÂÂ 
GET_RESULT_COUNT
ÂÂ -
=
ÂÂ. /
$strÂÂ0 è
;ÂÂè ê
private
ËË 
const
ËË 
string
ËË (
GET_RESULT_COUNT_MONITORED
ËË 7
=
ËË8 9
$str
ËË: |
;
ËË| }
private
ÍÍ 
const
ÍÍ 
string
ÍÍ 
GET_RUNS
ÍÍ %
=
ÍÍ& '
$str
ÍÍ( Z
;
ÍÍZ [
private
ÎÎ 
const
ÎÎ 
string
ÎÎ $
GET_SERIALIZED_RESULTS
ÎÎ 3
=
ÎÎ4 5
$strÎÎ6 à
;ÎÎà â
private
ÏÏ 
const
ÏÏ 
string
ÏÏ .
 INSERT_RUN_INTO_RESULT_TABLE_SQL
ÏÏ =
=
ÏÏ> ?
$strÏÏ@ ¨
;ÏÏ¨ ≠
private
ÌÌ 
const
ÌÌ 
int
ÌÌ 
SCHEMA_VERSION
ÌÌ (
=
ÌÌ) *
$num
ÌÌ+ ,
;
ÌÌ, -
private
ÓÓ 
const
ÓÓ 
string
ÓÓ :
,SQL_CHECK_IF_COMPARISON_PREVIOUSLY_COMPLETED
ÓÓ I
=
ÓÓJ K
$strÓÓL •
;ÓÓ• ¶
private
ÔÔ 
const
ÔÔ 
string
ÔÔ (
SQL_CREATE_COLLECT_RESULTS
ÔÔ 7
=
ÔÔ8 9
$strÔÔ: ¨
;ÔÔ¨ ≠
private
 
const
 
string
 6
(SQL_CREATE_COLLECT_RUN_ID_IDENTITY_INDEX
 E
=
F G
$strH £
;£ §
private
ÒÒ 
const
ÒÒ 
string
ÒÒ -
SQL_CREATE_COLLECT_RUN_ID_INDEX
ÒÒ <
=
ÒÒ= >
$strÒÒ? á
;ÒÒá à
private
ÚÚ 
const
ÚÚ 
string
ÚÚ @
2SQL_CREATE_COLLECT_RUN_KEY_IDENTITY_COMBINED_INDEX
ÚÚ O
=
ÚÚP Q
$strÚÚR ¬
;ÚÚ¬ √
private
ÛÛ 
const
ÛÛ 
string
ÛÛ '
SQL_CREATE_FILE_MONITORED
ÛÛ 6
=
ÛÛ7 8
$strÛÛ9 ô
;ÛÛô ö
private
ÙÙ 
const
ÙÙ 
string
ÙÙ 0
"SQL_CREATE_FINDINGS_IDENTITY_INDEX
ÙÙ ?
=
ÙÙ@ A
$strÙÙB à
;ÙÙà â
private
ıı 
const
ıı 
string
ıı -
SQL_CREATE_FINDINGS_LEVEL_INDEX
ıı <
=
ıı= >
$str
ıı? 
;ıı Ä
private
ˆˆ 
const
ˆˆ 
string
ˆˆ 9
+SQL_CREATE_FINDINGS_LEVEL_RESULT_TYPE_INDEX
ˆˆ H
=
ˆˆI J
$strˆˆK §
;ˆˆ§ •
private
˜˜ 
const
˜˜ 
string
˜˜ 3
%SQL_CREATE_FINDINGS_RESULT_TYPE_INDEX
˜˜ B
=
˜˜C D
$str˜˜E ë
;˜˜ë í
private
¯¯ 
const
¯¯ 
string
¯¯ )
SQL_CREATE_FINDINGS_RESULTS
¯¯ 8
=
¯¯9 :
$str¯¯; ƒ
;¯¯ƒ ≈
private
˘˘ 
const
˘˘ 
string
˘˘ +
SQL_CREATE_PERSISTED_SETTINGS
˘˘ :
=
˘˘; <
$str˘˘= ì
;˘˘ì î
private
˙˙ 
const
˙˙ 
string
˙˙  
SQL_CREATE_RESULTS
˙˙ /
=
˙˙0 1
$str˙˙2 å
;˙˙å ç
private
˚˚ 
const
˚˚ 
string
˚˚ 
SQL_CREATE_RUNS
˚˚ ,
=
˚˚- .
$str
˚˚/ 
;˚˚ Ä
private
¸¸ 
const
¸¸ 
string
¸¸ 
SQL_DELETE_RUN
¸¸ +
=
¸¸, -
$str
¸¸. X
;
¸¸X Y
private
˝˝ 
const
˝˝ 
string
˝˝ *
SQL_GET_COLLECT_MISSING_IN_B
˝˝ 9
=
˝˝: ;
$str˝˝< Ã
;˝˝Ã Õ
private
ˇˇ 
const
ˇˇ 
string
ˇˇ &
SQL_GET_COLLECT_MODIFIED
ˇˇ 5
=
ˇˇ6 7
$strˇˇ8 ö
+ˇˇõ ú
$strÄÄ< ñ
+ÄÄó ò
$str
ÅÅ@ ~
+ÅÅ Ä
$str
ÇÇD |
+
ÇÇ} ~
$strÉÉH ›
;ÉÉ› ﬁ
private
ÖÖ 
const
ÖÖ 
string
ÖÖ !
SQL_GET_NUM_RESULTS
ÖÖ 0
=
ÖÖ1 2
$strÖÖ3 î
;ÖÖî ï
private
ÜÜ 
const
ÜÜ 
string
ÜÜ (
SQL_GET_PERSISTED_SETTINGS
ÜÜ 7
=
ÜÜ8 9
$str
ÜÜ: r
;
ÜÜr s
private
áá 
const
áá 
string
áá )
SQL_GET_PLATFORM_FROM_RUNID
áá 8
=
áá9 :
$str
áá; m
;
áám n
private
àà 
const
àà 
string
àà )
SQL_GET_RESULT_TYPES_COUNTS
àà 8
=
àà9 :
$stràà; ö
;ààö õ
private
ââ 
const
ââ 
string
ââ '
SQL_GET_RESULTS_BY_RUN_ID
ââ 6
=
ââ7 8
$str
ââ9 g
;
ââg h
private
ää 
const
ää 
string
ää 
SQL_GET_RUN
ää (
=
ää) *
$str
ää+ V
;
ääV W
private
ãã 
const
ãã 
string
ãã 

SQL_INSERT
ãã '
=
ãã( )
$strãã* œ
;ããœ –
private
åå 
const
åå 
string
åå (
SQL_INSERT_FINDINGS_RESULT
åå 7
=
åå8 9
$stråå: Ì
;ååÌ Ó
private
çç 
const
çç 
string
çç 
SQL_INSERT_RUN
çç +
=
çç, -
$strçç. Ä
;ççÄ Å
private
éé 
const
éé 
string
éé  
SQL_QUERY_ANALYZED
éé /
=
éé0 1
$str
éé2 `
;
éé` a
private
èè 
const
èè 
string
èè &
SQL_SELECT_LATEST_N_RUNS
èè 5
=
èè6 7
$strèè8 å
;èèå ç
private
êê 
const
êê 
string
êê 
SQL_TRUNCATE_RUN
êê -
=
êê. /
$str
êê0 W
;
êêW X
private
ëë 
const
ëë 
string
ëë +
SQL_UPSERT_PERSISTED_SETTINGS
ëë :
=
ëë; <
$strëë= ì
;ëëì î
private
íí 
const
íí 
string
íí 

SQL_VACUUM
íí '
=
íí( )
$str
íí* 2
;
íí2 3
private
ìì 
const
ìì 
string
ìì (
UPDATE_RUN_IN_RESULT_TABLE
ìì 7
=
ìì8 9
$strìì: ß
;ììß ®
private
ùù 
static
ùù 

DBSettings
ùù !

dbSettings
ùù" ,
=
ùù- .
new
ùù/ 2

DBSettings
ùù3 =
(
ùù= >
)
ùù> ?
;
ùù? @
private
üü 
static
üü -
SystemSQLiteSqlConnectionHolder
üü 6#
GenerateSqlConnection
üü7 L
(
üüL M
int
üüM P
i
üüQ R
)
üüR S
{
†† 	
if
°° 
(
°° 
i
°° 
==
°° 
$num
°° 
)
°° 
{
¢¢ 
return
££ 
new
££ -
SystemSQLiteSqlConnectionHolder
££ :
(
££: ;
SQLiteFilename
££; I
,
££I J

dbSettings
££K U
)
££U V
;
££V W
}
§§ 
else
•• 
{
¶¶ 
return
ßß 
new
ßß -
SystemSQLiteSqlConnectionHolder
ßß :
(
ßß: ;
$"
ßß; =
{
ßß= >
SQLiteFilename
ßß> L
}
ßßL M
$str
ßßM N
{
ßßN O
i
ßßO P
}
ßßP Q
"
ßßQ R
,
ßßR S

dbSettings
ßßT ^
)
ßß^ _
;
ßß_ `
}
®® 
}
©© 	
private
´´ 
static
´´ 
Settings
´´ 
?
´´  
GetSettings
´´! ,
(
´´, -
)
´´- .
{
¨¨ 	
try
≠≠ 
{
ÆÆ 
using
ØØ 
var
ØØ 
getSettings
ØØ %
=
ØØ& '
new
ØØ( +
SQLiteCommand
ØØ, 9
(
ØØ9 :(
SQL_GET_PERSISTED_SETTINGS
ØØ: T
,
ØØT U
MainConnection
ØØV d
?
ØØd e
.
ØØe f

Connection
ØØf p
,
ØØp q
MainConnectionØØr Ä
?ØØÄ Å
.ØØÅ Ç
TransactionØØÇ ç
)ØØç é
;ØØé è
getSettings
∞∞ 
.
∞∞ 

Parameters
∞∞ &
.
∞∞& '
AddWithValue
∞∞' 3
(
∞∞3 4
$str
∞∞4 9
,
∞∞9 :
$str
∞∞; F
)
∞∞F G
;
∞∞G H
using
±± 
var
±± 
reader
±±  
=
±±! "
getSettings
±±# .
.
±±. /
ExecuteReader
±±/ <
(
±±< =
)
±±= >
;
±±> ?
if
¥¥ 
(
¥¥ 
reader
¥¥ 
.
¥¥ 
HasRows
¥¥ "
)
¥¥" #
{
µµ 
while
∂∂ 
(
∂∂ 
reader
∂∂ !
.
∂∂! "
Read
∂∂" &
(
∂∂& '
)
∂∂' (
)
∂∂( )
{
∑∑ 
return
∏∏ 
JsonConvert
∏∏ *
.
∏∏* +
DeserializeObject
∏∏+ <
<
∏∏< =
Settings
∏∏= E
>
∏∏E F
(
∏∏F G
(
∏∏G H
string
∏∏H N
)
∏∏N O
reader
∏∏O U
[
∏∏U V
$str
∏∏V b
]
∏∏b c
)
∏∏c d
;
∏∏d e
}
ππ 
}
∫∫ 
}
ªª 
catch
ºº 
(
ºº 
	Exception
ºº 
e
ºº 
)
ºº 
when
ºº  $
(
ºº% &
e
ºº& '
is
ºº( *
SQLiteException
ºº+ :
||
ºº; =
e
ºº> ?
is
ºº@ B#
ArgumentNullException
ººC X
||
ººY [
e
ºº\ ]
is
ºº^ `$
NullReferenceException
ººa w
)
ººw x
{
ΩΩ 
}
øø 
return
¡¡ 
null
¡¡ 
;
¡¡ 
}
¬¬ 	
private
ƒƒ 
static
ƒƒ 
void
ƒƒ 
SetSettings
ƒƒ '
(
ƒƒ' (
Settings
ƒƒ( 0
settings
ƒƒ1 9
)
ƒƒ9 :
{
≈≈ 	
try
∆∆ 
{
«« 
using
»» 
var
»» 
cmd
»» 
=
»» 
new
»»  #
SQLiteCommand
»»$ 1
(
»»1 2+
SQL_UPSERT_PERSISTED_SETTINGS
»»2 O
,
»»O P
MainConnection
»»Q _
?
»»_ `
.
»»` a

Connection
»»a k
,
»»k l
MainConnection
»»m {
?
»»{ |
.
»»| }
Transaction»»} à
)»»à â
;»»â ä
cmd
…… 
.
…… 

Parameters
…… 
.
…… 
AddWithValue
…… +
(
……+ ,
$str
……, 9
,
……9 :
JsonConvert
……; F
.
……F G
SerializeObject
……G V
(
……V W
settings
……W _
)
……_ `
)
……` a
;
……a b
cmd
   
.
   

Parameters
   
.
   
AddWithValue
   +
(
  + ,
$str
  , 1
,
  1 2
$str
  3 >
)
  > ?
;
  ? @
cmd
ÀÀ 
.
ÀÀ 
ExecuteNonQuery
ÀÀ #
(
ÀÀ# $
)
ÀÀ$ %
;
ÀÀ% &
}
ÃÃ 
catch
ÕÕ 
(
ÕÕ 
SQLiteException
ÕÕ "
)
ÕÕ" #
{
ÕÕ$ %
}
ÕÕ& '
catch
œœ 
(
œœ $
NullReferenceException
œœ )
)
œœ) *
{
œœ+ ,
}
œœ- .
}
–– 	
}
—— 
}““ Í>
QD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\SystemSqliteInsertTests.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .

Benchmarks. 8
{ 
[ %
MarkdownExporterAttribute 
. 
GitHub %
]% &
[		 !
JsonExporterAttribute		 
.		 
Full		 
]		  
public

 

class

 6
*SystemSqliteInsertTestsWithoutTransactions

 ;
:

< = 
AsaDatabaseBenchmark

> R
{ 
public 6
*SystemSqliteInsertTestsWithoutTransactions 9
(9 :
): ;
{ 	
Logger 
. 
Setup 
( 
true 
, 
true #
)# $
;$ %
Strings 
. 
Setup 
( 
) 
; 
} 	
[ 	
Params	 
( 
$str 
) 
] 
public 
string 
JournalMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Params	 
( 
$str 
) 
] 
public 
string 
LockingMode !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Params	 
( 
$num 
) 
] 
public 
int 
N 
{ 
get 
; 
set 
;  
}! "
[## 	
Params##	 
(## 
$num## 
)## 
]## 
public$$ 
int$$ 
ObjectPadding$$  
{$$! "
get$$# &
;$$& '
set$$( +
;$$+ ,
}$$- .
[&& 	
Params&&	 
(&& 
$num&& 
)&& 
]&& 
public'' 
int'' 
PageSize'' 
{'' 
get'' !
;''! "
set''# &
;''& '
}''( )
[** 	
Params**	 
(** 
$num** 
,** 
$num** 
,** 
$num** 
,** 
$num** 
,** 
$num** 
,** 
$num**  
,**  !
$num**" #
,**# $
$num**% &
,**& '
$num**( )
,**) *
$num**+ -
,**- .
$num**/ 1
,**1 2
$num**3 5
)**5 6
]**6 7
public++ 
int++ 
Shards++ 
{++ 
get++ 
;++  
set++! $
;++$ %
}++& '
[// 	
Params//	 
(// 
$num// 
)// 
]// 
public00 
int00 
StartingSize00 
{00  !
get00" %
;00% &
set00' *
;00* +
}00, -
[22 	
Params22	 
(22 
$str22 
)22 
]22 
public33 
string33 
Synchronous33 !
{33" #
get33$ '
;33' (
set33) ,
;33, -
}33. /
public55 
static55 
void55 
Insert_X_Objects55 +
(55+ ,
int55, /
X550 1
,551 2
int553 6
ObjectPadding557 D
=55E F
$num55G H
,55H I
string55J P
runName55Q X
=55Y Z
$str55[ m
)55m n
{66 	
Parallel77 
.77 
For77 
(77 
$num77 
,77 
X77 
,77 
i77  
=>77! #
{88 
var99 
obj99 
=99 
GetRandomObject99 )
(99) *
ObjectPadding99* 7
)997 8
;998 9'
SystemSQLiteDatabaseManager:: +
.::+ ,
Write::, 1
(::1 2
obj::2 5
,::5 6
runName::7 >
)::> ?
;::? @
BagOfObjects;; 
.;; 
Add;;  
(;;  !
obj;;! $
);;$ %
;;;% &
}<< 
)<< 
;<< 
while>> 
(>> '
SystemSQLiteDatabaseManager>> .
.>>. /
HasElements>>/ :
(>>: ;
)>>; <
)>>< =
{?? 
Thread@@ 
.@@ 
Sleep@@ 
(@@ 
$num@@ 
)@@ 
;@@  
}AA 
}BB 	
[DD 	
GlobalCleanupDD	 
]DD 
publicEE 
voidEE 
GlobalCleanupEE !
(EE! "
)EE" #
{FF 	
SetupGG 
(GG 
)GG 
;GG '
SystemSQLiteDatabaseManagerHH '
.HH' (
DestroyHH( /
(HH/ 0
)HH0 1
;HH1 2
}II 	
[KK 	
GlobalSetupKK	 
]KK 
publicLL 
voidLL 
GlobalSetupLL 
(LL  
)LL  !
{MM 	
PopulateDatabasesNN 
(NN 
)NN 
;NN  
}OO 	
[QQ 	
	BenchmarkQQ	 
]QQ 
publicRR 
voidRR 
Insert_N_ObjectsRR $
(RR$ %
)RR% &
=>RR' )
Insert_X_ObjectsRR* :
(RR: ;
NRR; <
,RR< =
ObjectPaddingRR> K
,RRK L
$strRRM _
)RR_ `
;RR` a
[TT 	
IterationCleanupTT	 
]TT 
publicUU 
voidUU 
IterationCleanupUU $
(UU$ %
)UU% &
{VV 	'
SystemSQLiteDatabaseManagerWW '
.WW' (
CloseDatabaseWW( 5
(WW5 6
)WW6 7
;WW7 8
}XX 	
[ZZ 	
IterationSetupZZ	 
]ZZ 
public[[ 
void[[ 
IterationSetup[[ "
([[" #
)[[# $
{\\ 	
Setup]] 
(]] 
)]] 
;]] '
SystemSQLiteDatabaseManager^^ '
.^^' (
BeginTransaction^^( 8
(^^8 9
)^^9 :
;^^: ;
}__ 	
publicaa 
voidaa 
PopulateDatabasesaa %
(aa% &
)aa& '
{bb 	
Setupcc 
(cc 
)cc 
;cc '
SystemSQLiteDatabaseManagerdd '
.dd' (
BeginTransactiondd( 8
(dd8 9
)dd9 :
;dd: ;
Insert_X_Objectsff 
(ff 
StartingSizeff )
,ff) *
ObjectPaddingff+ 8
,ff8 9
$strff: L
)ffL M
;ffM N'
SystemSQLiteDatabaseManagerhh '
.hh' (
Commithh( .
(hh. /
)hh/ 0
;hh0 1'
SystemSQLiteDatabaseManagerii '
.ii' (
CloseDatabaseii( 5
(ii5 6
)ii6 7
;ii7 8
}jj 	
privatell 
voidll 
Setupll 
(ll 
)ll 
{mm 	'
SystemSQLiteDatabaseManagernn '
.nn' (
Setupnn( -
(nn- .
filenamenn. 6
:nn6 7
$"nn8 :
$strnn: G
{nnG H
ShardsnnH N
}nnN O
$strnnO V
"nnV W
,nnW X
newnnY \

DBSettingsnn] g
(nng h
)nnh i
{oo 
JournalModepp 
=pp 
JournalModepp )
,pp) *
LockingModeqq 
=qq 
LockingModeqq )
,qq) *
PageSizerr 
=rr 
PageSizerr #
,rr# $
ShardingFactorss 
=ss  
Shardsss! '
,ss' (
Synchronoustt 
=tt 
Synchronoustt )
}uu 
)uu 
;uu 
}vv 	
}ww 
}xx Œ\
YD:\sonarcube_projects\AttackSurfaceAnalyzer\Benchmarks\SystemSqliteSqlConnectionHolder.cs
	namespace 	
	Microsoft
 
. 
CST 
. !
AttackSurfaceAnalyzer -
.- .
Objects. 5
{ 
public 

class +
SystemSQLiteSqlConnectionHolder 0
{ 
public +
SystemSQLiteSqlConnectionHolder .
(. /
string/ 5
databaseFilename6 F
,F G

DBSettingsH R
?R S

dBSettingsT ^
=_ `
defaulta h
,h i
intj m
tableShardsn y
=z {
$num| }
)} ~
{ 	
	_settings 
= 

dBSettings "
==# %
null& *
?+ ,
new- 0

DBSettings1 ;
(; <
)< =
:> ?

dBSettings@ J
;J K
Source 
= 
databaseFilename %
;% &

Connection 
= 
new 
SQLiteConnection -
(- .
$". 0
$str0 <
{< =
Source= C
}C D
$strD P
{P Q
	_settingsQ Z
.Z [
PageSize[ c
}c d
$strd s
{s t
	_settingst }
.} ~
JournalMode	~ â
}
â ä
$str
ä ò
{
ò ô
	_settings
ô ¢
.
¢ £
Synchronous
£ Æ
}
Æ Ø
$str
Ø ∞
"
∞ ±
)
± ≤
;
≤ ≥

Connection 
. 
Open 
( 
) 
; 
var 
command 
= 
string  
.  !
Format! '
(' (
CultureInfo( 3
.3 4
InvariantCulture4 D
,D E
PRAGMASF M
,M N
	_settingsO X
.X Y
LockingModeY d
)d e
;e f
using 
var 
cmd 
= 
new 
SQLiteCommand  -
(- .
command. 5
,5 6

Connection7 A
)A B
;B C
cmd 
. 
ExecuteNonQuery 
(  
)  !
;! "
TableShards 
= 
tableShards %
;% &
StartWriter 
( 
) 
; 

FlushCount 
= 
	_settings "
." #

FlushCount# -
;- .
} 	
public!! 
SQLiteConnection!! 

Connection!!  *
{!!+ ,
get!!- 0
;!!0 1
set!!2 5
;!!5 6
}!!7 8
public"" 
int"" 

FlushCount"" 
{"" 
get""  #
;""# $
set""% (
;""( )
}""* +
="", -
-"". /
$num""/ 0
;""0 1
public## 
bool## 
KeepRunning## 
{##  !
get##" %
;##% &
set##' *
;##* +
}##, -
public$$ 
string$$ 
Source$$ 
{$$ 
get$$ "
;$$" #
set$$$ '
;$$' (
}$$) *
public%% 
int%% 
TableShards%% 
{%%  
get%%! $
;%%$ %
set%%& )
;%%) *
}%%+ ,
=%%- .
$num%%/ 0
;%%0 1
public&& 
SQLiteTransaction&&  
?&&  !
Transaction&&" -
{&&. /
get&&0 3
;&&3 4
set&&5 8
;&&8 9
}&&: ;
public'' 
ConcurrentQueue'' 
<'' 
WriteObject'' *
>''* +

WriteQueue'', 6
{''7 8
get''9 <
;''< =
private''> E
set''F I
;''I J
}''K L
=''M N
new''O R
ConcurrentQueue''S b
<''b c
WriteObject''c n
>''n o
(''o p
)''p q
;''q r
public)) 
void)) 
BeginTransaction)) $
())$ %
)))% &
{** 	
if++ 
(++ 
Transaction++ 
==++ 
null++ #
&&++$ &

Connection++' 1
!=++2 4
null++5 9
)++9 :
{,, 
Transaction-- 
=-- 

Connection-- (
.--( )
BeginTransaction--) 9
(--9 :
)--: ;
;--; <
}.. 
}// 	
public11 
void11 
Commit11 
(11 
)11 
{22 	
try33 
{44 
Transaction55 
?55 
.55 
Commit55 #
(55# $
)55$ %
;55% &
}66 
catch77 
(77 
	Exception77 
e77 
)77 
{88 
Log99 
.99 
Warning99 
(99 
e99 
,99 
$"99 !
$str99! :
{99: ;
Source99; A
}99A B
$str99B D
{99D E
e99E F
.99F G

StackTrace99G Q
}99Q R
"99R S
)99S T
;99T U
}:: 
finally;; 
{<< 
Transaction== 
=== 
null== "
;==" #
}>> 
}?? 	
publicAA 
voidAA 
DestroyAA 
(AA 
)AA 
{BB 	
ShutDownCC 
(CC 
)CC 
;CC 
tryDD 
{EE 
FileFF 
.FF 
DeleteFF 
(FF 
SourceFF "
)FF" #
;FF# $
}GG 
catchHH 
(HH 
	ExceptionHH 
eHH 
)HH 
{II 
LogJJ 
.JJ 
WarningJJ 
(JJ 
eJJ 
,JJ 
$"JJ !
$strJJ! >
{JJ> ?
SourceJJ? E
}JJE F
"JJF G
)JJG H
;JJH I
}KK 
}LL 	
publicNN 
voidNN 
KeepFlushQueueNN "
(NN" #
)NN# $
{OO 	
KeepRunningPP 
=PP 
truePP 
;PP 
whileQQ 
(QQ 
KeepRunningQQ 
)QQ 
{RR 
whileSS 
(SS 
!SS 

WriteQueueSS "
.SS" #
IsEmptySS# *
)SS* +
{TT 
ifUU 
(UU 

FlushCountUU "
>UU# $
$numUU% &
)UU& '
{VV 
ifWW 
(WW 
RecordCountWW '
%WW( )

FlushCountWW* 4
==WW5 7

FlushCountWW8 B
-WWC D
$numWWE F
)WWF G
{XX 
CommitYY "
(YY" #
)YY# $
;YY$ %
BeginTransactionZZ ,
(ZZ, -
)ZZ- .
;ZZ. /
}[[ 
}\\ 
	WriteNext]] 
(]] 
)]] 
;]]  
}^^ 
Thread__ 
.__ 
Sleep__ 
(__ 
$num__ 
)__ 
;__  
}`` 
}aa 	
publiccc 
voidcc 
	WriteNextcc 
(cc 
)cc 
{dd 	
stringee %
SQL_INSERT_COLLECT_RESULTee ,
=ee- .
$str	ee/ ∫
;
ee∫ ª
ifgg 
(gg 

WriteQueuegg 
.gg 

TryDequeuegg %
(gg% &
outgg& )
WriteObjectgg* 5
?gg5 6
objIngg7 <
)gg< =
)gg= >
{hh 
tryii 
{jj 
usingkk 
varkk 
cmdkk !
=kk" #
newkk$ '
SQLiteCommandkk( 5
(kk5 6%
SQL_INSERT_COLLECT_RESULTkk6 O
,kkO P

ConnectionkkQ [
,kk[ \
Transactionkk] h
)kkh i
;kki j
cmdll 
.ll 

Parametersll "
.ll" #
AddWithValuell# /
(ll/ 0
$strll0 9
,ll9 :
objInll; @
.ll@ A
RunIdllA F
)llF G
;llG H
cmdmm 
.mm 

Parametersmm "
.mm" #
AddWithValuemm# /
(mm/ 0
$strmm0 :
,mm: ;
objInmm< A
.mmA B
RowKeymmB H
)mmH I
;mmI J
cmdnn 
.nn 

Parametersnn "
.nn" #
AddWithValuenn# /
(nn/ 0
$strnn0 ;
,nn; <
objInnn= B
.nnB C
ColObjnnC I
?nnI J
.nnJ K
IdentitynnK S
)nnS T
;nnT U
cmdoo 
.oo 

Parametersoo "
.oo" #
AddWithValueoo# /
(oo/ 0
$stroo0 =
,oo= >
objInoo? D
.ooD E

SerializedooE O
)ooO P
;ooP Q
cmdpp 
.pp 

Parameterspp "
.pp" #
AddWithValuepp# /
(pp/ 0
$strpp0 >
,pp> ?
objInpp@ E
.ppE F
ColObjppF L
?ppL M
.ppM N

ResultTypeppN X
)ppX Y
;ppY Z
cmdqq 
.qq 
ExecuteNonQueryqq '
(qq' (
)qq( )
;qq) *
}rr 
catchss 
(ss 
SQLiteExceptionss &
ess' (
)ss( )
{tt 
Loguu 
.uu 
Debuguu 
(uu 
	exceptionuu '
:uu' (
euu) *
,uu* +
$"uu, .
$struu. <
{uu< =
objInuu= B
.uuB C
ColObjuuC I
?uuI J
.uuJ K
IdentityuuK S
}uuS T
$struuT a
"uua b
)uub c
;uuc d
}vv 
catchww 
(ww "
NullReferenceExceptionww -
)ww- .
{xx 
}yy 
}zz 
}{{ 	
internal}} 
void}} 
ShutDown}} 
(}} 
)}}  
{~~ 	
KeepRunning 
= 
false 
;  

Connection
ÄÄ 
.
ÄÄ 
Close
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 

Connection
ÅÅ 
.
ÅÅ 
Dispose
ÅÅ 
(
ÅÅ 
)
ÅÅ  
;
ÅÅ  !
Transaction
ÇÇ 
=
ÇÇ 
null
ÇÇ 
;
ÇÇ 
}
ÉÉ 	
internal
ÖÖ 
void
ÖÖ 
StartWriter
ÖÖ !
(
ÖÖ! "
)
ÖÖ" #
{
ÜÜ 	
(
áá 
(
áá 
Action
áá 
)
áá 
(
áá 
async
áá 
(
áá 
)
áá 
=>
áá !
{
àà 
await
ââ 
Task
ââ 
.
ââ 
Run
ââ 
(
ââ 
(
ââ  
)
ââ  !
=>
ââ" $
KeepFlushQueue
ââ% 3
(
ââ3 4
)
ââ4 5
)
ââ5 6
.
ââ6 7
ConfigureAwait
ââ7 E
(
ââE F
false
ââF K
)
ââK L
;
ââL M
}
ää 
)
ää 
)
ää 
(
ää 
)
ää 
;
ää 
}
ãã 	
private
çç 
const
çç 
string
çç 
PRAGMAS
çç $
=
çç% &
$str
çç' [
;
çç[ \
private
éé 
readonly
éé 

DBSettings
éé #
	_settings
éé$ -
;
éé- .
private
èè 
int
èè 
RecordCount
èè 
{
èè  !
get
èè" %
;
èè% &
set
èè' *
;
èè* +
}
èè, -
}
êê 
}ëë 